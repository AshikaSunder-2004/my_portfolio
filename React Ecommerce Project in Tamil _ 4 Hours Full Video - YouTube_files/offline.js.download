(function(g){var window=this;'use strict';var nT6=function(p){var d=new g.TM("und",new g.b0("Default","und",!0));d.captionTracks=p.captionTracks;return d},r5W=function(p){return new g.rv(function(d,b){var v=p.length,P=[];
if(v)for(var M=function(h,O){v--;P[h]=O;v==0&&d(P)},X=function(h){b(h)},a,F=0;F<p.length;F++)a=p[F],g.xNz(a,g.A7(M,F),X);
else d(P)})},HN=function(p){this.D=p},DR=function(){HN.apply(this,arguments)},fJX=function(){DR.apply(this,arguments)},uSF=function(){DR.apply(this,arguments)},lJQ=function(){DR.apply(this,arguments)},szC=function(){DR.apply(this,arguments)},ZC6=function(){DR.apply(this,arguments)},ETH=function(){DR.apply(this,arguments)},C22=function(){HN.apply(this,arguments)},N$6=function(){DR.apply(this,arguments)},GlF=function(){DR.apply(this,arguments)},wd2=function(){DR.apply(this,arguments)},Ui6=function(){DR.apply(this,
arguments)},c5m=function(){DR.apply(this,arguments)},y5F=function(){DR.apply(this,arguments)},IJX=function(){DR.apply(this,arguments)},zF4=function(){DR.apply(this,arguments)},jzm=function(){DR.apply(this,arguments)},tEW=function(){DR.apply(this,arguments)},iCQ=function(){DR.apply(this,arguments)},HCQ=function(){DR.apply(this,arguments)},DiW=function(){HN.apply(this,arguments)},VEQ=function(){DR.apply(this,arguments)},eFX=function(){DR.apply(this,arguments)},SUq=function(){DR.apply(this,arguments)},
YUH=function(){DR.apply(this,arguments)},gTq=function(){DR.apply(this,arguments)},LZz=function(){DR.apply(this,arguments)},Qz2=function(){DR.apply(this,arguments)},$iW=function(){DR.apply(this,arguments)},mi2=function(){DR.apply(this,arguments)},KZ6=function(){HN.apply(this,arguments)},xiR=function(){HN.apply(this,arguments)},B$W=function(){HN.apply(this,arguments)},RFR=function(){DR.apply(this,arguments)},T$z=function(){DR.apply(this,arguments)},A5W=function(){DR.apply(this,arguments)},WZR=function(){DR.apply(this,
arguments)},ppC=function(){DR.apply(this,arguments)},dg6=function(){DR.apply(this,arguments)},brR=function(){DR.apply(this,arguments)},vpH=function(){DR.apply(this,arguments)},P86=function(){DR.apply(this,arguments)},Msq=function(){DR.apply(this,arguments)},Xp3=function(){DR.apply(this,arguments)},qmH=function(){DR.apply(this,arguments)},a66=function(){DR.apply(this,arguments)},opX=function(){DR.apply(this,arguments)},FSQ=function(){DR.apply(this,arguments)},hu6=function(){DR.apply(this,arguments)},
OrW=function(){DR.apply(this,arguments)},Jfz=function(){DR.apply(this,arguments)},kKW=function(){DR.apply(this,arguments)},npQ=function(){DR.apply(this,arguments)},rfW=function(){DR.apply(this,arguments)},f63=function(){DR.apply(this,arguments)},ueq=function(){DR.apply(this,arguments)},l6q=function(){DR.apply(this,arguments)},sxQ=function(){DR.apply(this,arguments)},ZrC=function(){DR.apply(this,arguments)},EpR=function(){HN.apply(this,arguments)},C8z=function(){DR.apply(this,arguments)},Noq=function(){DR.apply(this,
arguments)},GKF=function(){DR.apply(this,arguments)},wp2=function(){DR.apply(this,arguments)},UgQ=function(){DR.apply(this,arguments)},cfq=function(){DR.apply(this,arguments)},yfF=function(){DR.apply(this,arguments)},I6m=function(){DR.apply(this,arguments)},zuW=function(){DR.apply(this,arguments)},jxC=function(){DR.apply(this,arguments)},tsR=function(){DR.apply(this,arguments)},irX=function(){DR.apply(this,arguments)},HrH=function(){DR.apply(this,arguments)},Dgq=function(){DR.apply(this,arguments)},
Vsq=function(){DR.apply(this,arguments)},euQ=function(){DR.apply(this,arguments)},SmR=function(){DR.apply(this,arguments)},Ymq=function(){DR.apply(this,arguments)},gp6=function(){DR.apply(this,arguments)},LS2=function(){DR.apply(this,arguments)},QxR=function(){DR.apply(this,arguments)},$gq=function(){DR.apply(this,arguments)},mg3=function(){DR.apply(this,arguments)},KS2=function(){DR.apply(this,arguments)},xgm=function(){DR.apply(this,arguments)},BoF=function(){DR.apply(this,arguments)},RuF=function(){DR.apply(this,
arguments)},To4=function(){DR.apply(this,arguments)},AfC=function(){DR.apply(this,arguments)},WSq=function(){DR.apply(this,arguments)},paR=function(p){p=p.key||p.id;
if(!p)throw Error("Entity key is missing");return p},dMF=function(){if(Vk)return Vk();
var p={};Vk=g.vv("PersistentEntityStoreDb",{Mw:(p.EntityStore={ul:1},p.EntityAssociationStore={ul:2},p),shared:!1,upgrade:function(d,b){b(1)&&g.en(g.jn(d,"EntityStore",{keyPath:"key"}),"entityType","entityType");b(2)&&(d=g.jn(d,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.en(d,"byParentEntityKey","parentEntityKey"),g.en(d,"byChildEntityKey","childEntityKey"))},
version:3});return Vk()},bXF=function(p){return g.KU(dMF(),p)},vNF=function(p){return g.KU((0,g.x66)(),p)},e1=function(p){this.token=p},S1=function(p,d){d=d===void 0?{}:d;
g.RN.call(this,g.BRz[p],Object.assign({},{name:"PESEncoderError",type:p},d));this.type=p;this.level="WARNING";Object.setPrototypeOf(this,S1.prototype)},Pn2=function(p){return new S1("WRONG_DATA_TYPE",{ph:p})},MUz=function(p){return p instanceof Error?new S1("UNKNOWN_ENCODE_ERROR",{Ss:p.message}):new S1("UNKNOWN_ENCODE_ERROR")},XaC=function(p){return p instanceof Error?new S1("UNKNOWN_DECODE_ERROR",{Ss:p.message}):new S1("UNKNOWN_DECODE_ERROR")},qPz=function(p,d){p=p instanceof S1?p:d(p);
g.Hi(p);throw p;},ajR=function(){},oNz=function(p,d,b){try{return p.B(d,b)}catch(v){qPz(v,MUz)}},FUH=function(p){p=(new TextEncoder).encode(p).subarray(0,16);
var d=new Uint8Array(16);d.set(p);return d},Y4=function(p){this.D=p},OXQ=function(p){var d=hy4[p];
if(d)return d;g.DF(new g.RN("Entity model not found.",{entityType:p}))},J1m=function(p,d){this.D=p;
this.U=d;this.B={}},nNQ=function(p,d){a:{p=kx3(p.U,d.version);
try{var b=p.U(d.data,d.key);break a}catch(v){qPz(v,XaC)}b=void 0}return b},gO=function(p,d,b){return p.D.objectStore("EntityStore").get(d).then(function(v){if(v){if(b&&v.entityType!==b)throw Error("Incorrect entity type");
return nNQ(p,v)}})},L6=function(p,d,b){return b?(b=b.map(function(v){return gO(p,v,d)}),g.w2.all(b)):p.D.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(d)).then(function(v){return v.map(function(P){return nNQ(p,P)})})},$4=function(p,d,b){var v=paR(d),P=kx3(p.U,1),M=Object.assign({},d);
return p.D.objectStore("EntityStore").get(v).then(function(X){if(X){if(X.entityType!==b)throw Error("Incorrect entity type");M.entityMetadata||(X=nNQ(p,X),M.entityMetadata=X.entityMetadata)}}).then(function(){var X={key:v,
entityType:b,data:oNz(P,M,v),version:1};return g.w2.all([g.HQ(p.D.objectStore("EntityStore"),X),r1Q(p,M,b)])}).then(function(){Qk(p,v,b);
return v})},fj3=function(p,d,b){d=d.map(function(v){return $4(p,v,b)});
return g.w2.all(d)},ma=function(p,d,b){if(b==null?0:b.Yn){var v=new Set;
return uPQ(p,d,v).then(function(){for(var M=[],X=g.u(v),a=X.next();!a.done;a=X.next())M.push(ma(p,a.value));return g.w2.all(M).then(function(){})})}var P=g.qd(d).entityType;
return g.w2.all([p.D.objectStore("EntityStore").delete(d),lj3(p,d)]).then(function(){Qk(p,d,P)})},swz=function(p,d){return g.LU(p.D.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(d)},function(b){return g.w2.all([b.delete(),
lj3(p,b.cursor.primaryKey)]).then(function(){Qk(p,b.cursor.primaryKey,d);return g.YW(b)})})},ZX3=function(p,d,b,v){var P=kx3(p.U,1);
return gO(p,d,v).then(function(M){if(M){M=g.fO(M,b);var X={key:d,entityType:v,data:oNz(P,M,d),version:1};return g.w2.all([g.HQ(p.D.objectStore("EntityStore"),X),r1Q(p,M,v)])}}).then(function(){Qk(p,d,v);
return d})},Qk=function(p,d,b){var v=p.B[b];
v||(v=new Set,p.B[b]=v);v.add(d)},ENW=function(p,d,b){var v=paR(d);
b=OXQ(b);if(!b)return g.w2.resolve([]);b=new b(d);p=p.D.objectStore("EntityAssociationStore");d=[];b=g.u(b.U());for(var P=b.next();!P.done;P=b.next())d.push(g.HQ(p,{parentEntityKey:v,childEntityKey:P.value}));return g.w2.all(d).then(function(M){return M.map(function(X){return X[1]})})},lj3=function(p,d){return p.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(d))},r1Q=function(p,d,b){var v=paR(d);
return lj3(p,v).then(function(){return ENW(p,d,b)})},uPQ=function(p,d,b){if(b.has(d))return g.w2.resolve(void 0);
b.add(d);return Cnz(p,d).then(function(v){return p.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(d)).then(function(){return v})}).then(function(v){var P=g.w2.resolve(void 0);
v=g.u(v);for(var M=v.next(),X={};!M.done;X={Dz:void 0},M=v.next())X.Dz=M.value,P=P.then(function(a){return function(){return uPQ(p,a.Dz,b)}}(X));
return P}).then(function(){})},Cnz=function(p,d){var b=p.D.objectStore("EntityAssociationStore");
return b.index("byParentEntityKey").getAll(IDBKeyRange.only(d)).then(function(v){var P=[];v=g.u(v);for(var M=v.next();!M.done;M=v.next())M=M.value,P.push(b.index("byChildEntityKey").getAll(M.childEntityKey));return g.w2.all(P)}).then(function(v){var P=[];
v=g.u(v);for(var M=v.next();!M.done;M=v.next())M=M.value,M.length===1&&P.push(M[0].childEntityKey);return P})},K6=function(){},NSR=function(){this.D={};
this.D[0]=new K6;if(!g.N5("aes_pes_encoder_killswitch")){var p=this.D;try{var d=g.TZ();var b=FUH(d);var v=new Y4(new g.Cs(b),new g.ER(b))}catch(P){throw p=P instanceof Error?new S1("KEY_CREATION_FAILED",{Ss:P.message}):new S1("KEY_CREATION_FAILED"),g.Hi(p),p;}p[1]=v}},kx3=function(p,d){d=d===void 0?0:d;
p=p.D[d];if(!p)throw d=new S1("INVALID_ENCODER_VERSION",{ph:d}),g.Hi(d),d;return p},x4=function(p,d){g.e.call(this);
this.token=p;this.D=d;this.observers=[];p=new g.ee.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.TZ());p.onmessage=this.U.bind(this);this.channel=p},BN=function(p,d,b){var v,P,M,X;
return g.z(function(a){if(a.D==1)return g.y(a,bXF(p.token),2);if(a.D!=3)return v=a.U,g.y(a,g.ip(v,["EntityStore","EntityAssociationStore"],d,function(F){P=new J1m(F,p.D);return b(P)}),3);
M=a.U;P&&(X=P.B,Object.keys(X).length>0&&(p.channel.postMessage(X),GxF(p,X)));return a.return(M)})},RX=function(p,d,b){return BN(p,{mode:"readwrite",
Ib:!0},function(v){return $4(v,d,b)})},waC=function(p,d){return BN(p,{mode:"readwrite",
Ib:!0},function(b){return fj3(b,d,"offlineOrchestrationActionWrapperEntity")})},UM6=function(p,d){return BN(p,{mode:"readwrite",
Ib:!0},function(b){return ma(b,d)})},c1q=function(p){return BN(p,{mode:"readwrite",
Ib:!0},function(d){return swz(d,"videoPlaybackPositionEntity")})},TA=function(p,d,b){return BN(p,{mode:"readonly",
Ib:!0},function(v){return gO(v,d,b)})},AJ=function(p,d,b){return BN(p,{mode:"readonly",
Ib:!0},function(v){return L6(v,d,b)})},GxF=function(p,d){p=g.u(p.observers);
for(var b=p.next();!b.done;b=p.next())b=b.value,b(d)},y13=function(){var p,d,b;
return g.z(function(v){if(v.D==1)return g.sW(v,2),g.y(v,g.d_(),4);if(v.D!=2){p=v.U;if(!p||!g.Ay()||typeof g.ee.BroadcastChannel==="undefined")return v.return();d=new NSR;return v.return(new x4(p,d))}b=g.Cz(v);b instanceof Error&&g.Hi(b);return v.return()})},WN=function(){Ij4||(Ij4=y13());
return Ij4},zy2=function(p){var d;
p=(d=p.options)==null?void 0:d.persistenceOption;return p==="ENTITY_PERSISTENCE_OPTION_PERSIST"||p==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},jwH=function(p){var d;
return g.z(function(b){return b.D==1?g.y(b,WN(),2):(d=b.U)?g.y(b,BN(d,"readwrite",function(v){for(var P={},M=g.u(p),X=M.next(),a={};!X.done;a={WQ:void 0,Bo:void 0},X=M.next())a.WQ=X.value,a.WQ.entityKey&&zy2(a.WQ)&&(a.Bo=g.Nh(a.WQ.payload),X=void 0,a.WQ.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(X=function(F){return function(){return $4(v,F.WQ.payload[F.Bo],F.Bo)}}(a)),a.WQ.type==="ENTITY_MUTATION_TYPE_DELETE"&&(X=function(F){return function(){return ma(v,F.WQ.entityKey)}}(a)),a.WQ.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(X=function(F){return function(){return ZX3(v,F.WQ.entityKey,F.WQ.payload[F.Bo],F.Bo)}}(a)),X&&(P[a.WQ.entityKey]=P[a.WQ.entityKey]?P[a.WQ.entityKey].then(X):X()));
return g.w2.all(Object.values(P))}),0):b.return()})},tU3=function(p){var d;
return g.z(function(b){if(b.D==1){d=p.mutations;if(!d||d.length<=0)return b.return();if(g.Bc){var v={type:"ENTITY_LOADED"};d!==void 0&&(v.payload=d);g.Bc.dispatch(v)}return g.y(b,jwH(d),2)}d.length=0;g.l$(b)})},iXC=function(p){return p!==void 0},HXQ=function(p){var d=g.EK();
d=Object.assign({},d);p=Object.assign({},p);for(var b in d)p[b]?(d[b]!==4&&(d[b]=p[b]),delete p[b]):d[b]!==2&&(d[b]=4);Object.assign(d,p);g.$f7(d);JSON.stringify(d);return d},DMQ=function(p){var d,b;
return g.z(function(v){if(v.D==1)return g.y(v,g.d_(),2);if(v.D!=3)return(d=v.U)?g.y(v,g.Gu(d),3):v.return();b=v.U;return v.return(g.ip(b,["index","media","captions"],{mode:"readwrite",Ib:!0},function(P){var M=IDBKeyRange.bound(p+"|",p+"~");P=[P.objectStore("index").delete(M),P.objectStore("media").delete(M),P.objectStore("captions").delete(M)];return g.w2.all(P).then(function(){})}))})},VUC=function(){var p,d;
return g.z(function(b){if(b.D==1)return g.y(b,g.d_(),2);if(b.D!=3){p=b.U;if(!p)throw g.N_("rvdfd");return g.y(b,g.Gu(p),3)}d=b.U;return b.return(g.ip(d,["index","media"],{mode:"readwrite",Ib:!0},function(v){var P={};return g.Sn(v.objectStore("index"),{},function(M){var X=M.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),a=g.w2.resolve(void 0);if(X){var F=X[1];X=X[2];P[F]=P[F]||{};var h;P[F][X]=g.RIk((h=M.getValue())==null?void 0:h.fmts)}else a=M.delete().then(function(){});
return g.w2.all([g.YW(M),a]).then(function(O){return g.u(O).next().value})}).then(function(){for(var M={},X=g.u(Object.keys(P)),a=X.next();!a.done;a=X.next()){a=a.value;
var F=P[a].v;M[a]=P[a].a&&F?1:2}var h=HXQ(M);return g.Utk(v.objectStore("media"),{},function(O){var J=O.cursor.key.match(g.pDq);J&&M[J[1]]||v.objectStore("media").delete(O.cursor.key);return g.uOu(O)}).then(function(){return h})})}))})},eyH=function(p,d){var b,v;
return g.z(function(P){if(P.D==1)return g.y(P,g.d_(),2);if(P.D!=3){b=P.U;if(!b)throw g.N_("wct");return g.y(P,g.Gu(b),3)}v=P.U;return g.y(P,g.ip(v,["captions"],{mode:"readwrite",Ib:!0},function(M){var X=[];M=M.objectStore("captions");for(var a=0;a<d.length;a++){var F=g.HQ(M,d[a],p+"|"+d[a].metadata.vss_id);X.push(F)}return g.w2.all(X)}),0)})},SPR=function(p){var d,b,v;
return g.z(function(P){if(P.D==1)return d=IDBKeyRange.bound(p+"|",p+"~"),g.y(P,g.d_(),2);if(P.D!=3){b=P.U;if(!b)throw g.N_("gactfv");return g.y(P,g.Gu(b),3)}v=P.U;return P.return(v.getAll("captions",d))})},YPR=function(p){return g.z(function(d){g.NZ(p,0);
return d.return(DMQ(p))})},gNQ=function(p){return{context:g.AI(),
videoIds:p}},LUQ=function(p){return{context:g.AI(),
playlistIds:p}},Qwz=function(p){return{context:g.AI(),
offlinePlaylistSyncChecks:p}},$Mz=function(){this.D=new Map},KUq=function(){mM4||(mM4=new $Mz);
return mM4},xMX=function(p,d){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:p},metadata:d,statusCode:void 0,csn:void 0,can:void 0}},BS2=function(p,d,b){if(!b){var v=v===void 0?!1:v;
b=p.D.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!b||v)b=g.GW(16),p.D.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",b)}p={flowNonce:b,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:d.eventType};d.metadata&&(p.flowMetadata=d.metadata);d.statusCode!==void 0&&(p.flowEventStatus=d.statusCode);d.csn&&(p.csn=d.csn);d.can&&(p.can=d.can);g.Oe("flowEvent",p,void 0)},Ry4=function(p){var d,b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC,vm,rQ,N,w,c;
return g.z(function(t){if(t.D==1)return g.y(t,BN(p,{mode:"readonly",Ib:!0},function(D){return L6(D,"playbackData").then(function(b$){var MC=b$.map(function(rw){return rw.transfer}).filter(function(rw){return!!rw}),Xu=b$.map(function(rw){return rw.offlineVideoPolicy}).filter(function(rw){return!!rw}),H=b$.filter(function(rw){return!!rw.key}).map(function(rw){return g.aC(g.qd(rw.key).entityId,"downloadStatusEntity")});
MC=L6(D,"transfer",MC);Xu=L6(D,"offlineVideoPolicy",Xu);H=L6(D,"downloadStatusEntity",H);var h7=MC.then(function(rw){rw=rw.reduce(function(oK,zC){(zC==null?0:zC.offlineVideoStreams)&&oK.push.apply(oK,g.E(zC.offlineVideoStreams));return oK},[]).filter(function(oK){return!!oK});
return L6(D,"offlineVideoStreams",rw)});
return g.w2.all([MC,Xu,h7,H]).then(function(rw){var oK=g.u(rw);rw=oK.next().value;var zC=oK.next().value;var J4=oK.next().value;oK=oK.next().value;return[b$,rw,zC,J4,oK]})})}),2);
if(t.D!=3)return d=t.U,g.y(t,BN(p,{mode:"readonly",Ib:!0},function(D){return L6(D,"mainDownloadsListEntity").then(function(b$){var MC,Xu;return(Xu=(MC=b$[0])==null?void 0:MC.downloads)!=null?Xu:[]})}),3);
b=t.U;v=g.u(d);P=v.next().value;M=v.next().value;X=v.next().value;a=v.next().value;F=v.next().value;h=P;O=M;J=X;k=a;n=F;r={};Z={};C={};G={};U={};I=[];V=g.u(O);for(S=V.next();!S.done;S=V.next())(B=S.value)&&(r[B.key]=B);x=g.u(J);for(Pj=x.next();!Pj.done;Pj=x.next())(qC=Pj.value)&&(Z[qC.key]=qC);pz=g.u(n);for(Q=pz.next();!Q.done;Q=pz.next())(W=Q.value)&&(C[W.key]=W);l=g.u(k);for(m=l.next();!m.done;m=l.next())(Yu=m.value)&&(G[Yu.key]=Yu);Z2=g.u(b);for(O6=Z2.next();!O6.done;O6=Z2.next())UW=O6.value,TC=
void 0,U[(TC=UW.videoItem)!=null?TC:""]=!0,UW.videoItem&&(rQ=vm=void 0,N=(rQ=(vm=g.qd(UW.videoItem))==null?void 0:vm.entityId)!=null?rQ:"",I.push({externalVideoId:N}));w=h.filter(function(D){if(!D||!D.key||!D.offlineVideoPolicy)return!1;D=g.qd(D.key).entityId;D=g.aC(D,"downloadStatusEntity");var b$;return!(D&&((b$=C[D])==null?void 0:b$.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
c=w.map(function(D){var b$=r[D.transfer],MC=[];if(b$==null?0:b$.offlineVideoStreams)for(var Xu=g.u(b$.offlineVideoStreams),H=Xu.next();!H.done;H=Xu.next())(H=G[H.value])&&MC.push(H);Xu=Z[D.offlineVideoPolicy];H=U;var h7=D==null?void 0:D.playerResponseTimestamp,rw=g.qd(Xu.key).entityId;D=g.aC(rw,"mainVideoEntity");if(Xu.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var oK="OFFLINE_VIDEO_STATE_DISABLED";Xu.expirationTimestamp&&Number(Xu.expirationTimestamp)<Date.now()/1E3&&(oK="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Xu.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")oK="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(b$==null?void 0:b$.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":oK="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":oK="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":oK="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":oK="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":oK="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":oK="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:oK="OFFLINE_VIDEO_STATE_UNKNOWN"}if(oK==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(b$==null?void 0:b$.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":oK="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":oK="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":oK=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}rw={id:rw,videoState:oK};if(b$==null?0:b$.cotn)rw.cotn=b$.cotn;if(b$==null?0:b$.maximumDownloadQuality)rw.selectedVideoQuality=b$==null?void 0:b$.maximumDownloadQuality;if(b$==null?0:b$.lastProgressTimeMs)rw.lastProgressTimeMs=b$.lastProgressTimeMs;h7&&(rw.playerResponseSavedTimeMs=String(Number(h7)*1E3));b$=String;h7=0;MC=g.u(MC);for(oK=MC.next();!oK.done;oK=MC.next())if(oK=oK.value,oK.streamsProgress){oK=g.u(oK.streamsProgress);for(var zC=oK.next();!zC.done;zC=
oK.next()){var J4=void 0;h7+=Number((J4=zC.value.numBytesDownloaded)!=null?J4:0)}}rw.downloadedBytes=b$(h7);rw.selectedOfflineMode=H[D]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Xu.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(rw.offlinePlaybackDisabledReason=Xu.offlinePlaybackDisabledReason);return rw});
return t.return({offlineVideos:c,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:I}}})})},TS6=function(){this.locks=navigator.locks},A12=function(){try{var p=g.gw("ytglobal.locks_");
if(p)return p;var d;if(d=navigator){var b=navigator;d="locks"in b&&!!b.locks}if(d)return g.ee.localStorage&&g.ee.localStorage.getItem("noop"),p=new TS6,g.Se("ytglobal.locks_",p),p}catch(v){}},p7=function(){},WUm=function(){},pG2=function(p){if(p.includes(":"))throw Error("Invalid user cache name: "+p);
return p+":"+g.TZ("CacheStorage get")},dVC=function(){return g.z(function(p){if(dE!==void 0)return p.return(dE);
dE=new Promise(function(d){var b;return g.z(function(v){switch(v.D){case 1:return g.sW(v,2),g.y(v,bP.open("test-only"),4);case 4:return g.y(v,bP.delete("test-only"),5);case 5:g.EW(v,3);break;case 2:if(b=g.Cz(v),b instanceof Error&&b.name==="SecurityError")return d(!1),v.return();case 3:d("caches"in window),g.l$(v)}})});
return p.return(dE)})},vaQ=function(){return g.z(function(p){if(p.D==1)return g.y(p,dVC(),2);
if(!p.U)return p.return(void 0);bjQ||(bjQ=new WUm);return p.return(bjQ)})},v8=function(p,d,b){g.DF(new g.RN("Woffle: "+p,b?{cotn:b}:""));
d instanceof Error&&g.DF(d)},PhH=function(p){var d;
return g.z(function(b){if(b.D==1)return g.y(b,Ry4(p),2);d=b.U;g.Oe("offlineStateSnapshot",d);g.l$(b)})},P8=function(p){g.e.call(this);
var d=this;this.api=p;this.Up={NOJ:function(){return d.D},
JeN:function(){return d.U}};
typeof g.ee.BroadcastChannel!=="undefined"&&(this.D=new g.ee.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.TZ()),this.D.onmessage=this.B.bind(this),this.U=new g.ee.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.TZ()),this.U.onmessage=this.V.bind(this))},MY=function(p,d){p.api.KX("onOfflineOperationFailure",d);
var b;(b=p.D)==null||b.postMessage(d)},Miz=function(p,d,b,v){var P=this;
this.W=p;this.C=d;this.visibility=b;this.T=v;this.X=this.Z=this.S=this.B=this.D=!1;this.V=new g.bR(function(){P.lC()});
this.Up={qR:function(){return P.U},
lC:function(){P.lC()},
AeX:function(){return P.V}};
this.visibility.subscribe("visibilitystatechange",function(){P.eE()})},XGX=function(p){if(!p.B&&!p.D){var d=A12();
if(d){p.B=!0;var b=g.TZ("OfflineLockManager");d.request("woffle_orchestration_leader:"+b,{},function(){var v,P,M,X;return g.z(function(a){switch(a.D){case 1:return g.sW(a,2),p.U=new g.fC,p.D=!0,p.B=!1,g.y(a,p.W(),4);case 4:return g.y(a,p.U.promise,5);case 5:g.EW(a,0);break;case 2:v=g.Cz(a),((M=(P=p).T)==null?0:M.call(P,"wo_relinquish_leadership_on_lock_request_error"))||p.lC(),v instanceof Error&&(X=v,X.args=[{name:"WoLockManagerError",o$:v.name}],g.Hi(X)),g.l$(a)}})})}}},q1X=function(p){p.D&&(p.X=
!0,X4(p))},aQC=function(p,d){p.D&&(p.S=d,X4(p))},oaF=function(p,d){p.D&&(p.Z=d,X4(p))},X4=function(p){p.Z&&p.S&&p.X&&p.visibility.isBackground()?g.vg(p.V,6E4):p.V.stop()},qY=function(p){var d;
p.offlineDeleteReason=(d=p.offlineDeleteReason)!=null?d:"OFFLINE_DELETE_REASON_UNKNOWN";var b;p.offlineModeType=(b=p.offlineModeType)!=null?b:"OFFLINE_NOW";g.Oe("offlineDeleteEvent",p)},a6=function(p,d){var b=d.videoId;
var v=d.DZ;d=d.offlineModeType;p.encryptedVideoId=b;p.cotn=v==null?void 0:v.cotn;p.offlineabilityFormatType=v==null?void 0:v.maximumDownloadQuality;var P;p.isRefresh=(P=v==null?void 0:v.isRefresh)!=null?P:!1;var M;p.softErrorCount=(M=v==null?void 0:v.transferRetryCount)!=null?M:0;p.offlineModeType=d!=null?d:"OFFLINE_NOW";(p.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&p.statusType==="UNKNOWN_STATUS_TYPE"||!p.transferStatusType&&!p.statusType)&&g.DF(Error("Woffle unknown transfer status"));
g.Oe("offlineTransferStatusChanged",p)},Fp3=function(p,d,b,v){v={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!v};d&&b&&(d=Math.floor(d/1024).toFixed(),b=Math.floor(b/1024).toFixed(),v.alreadyDownloadedKbytes=d,v.totalFetchedKbytes=d,v.totalContentKbytes=b);a6(v,p)},h6W=function(p){a6({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},p)},Oj4=function(p){switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
o6=function(p){var d,b,v;
return((v=(d=p.actionMetadata)==null?void 0:(b=d.retryScheduleIntervalsInSeconds)==null?void 0:b.length)!=null?v:0)>0},F4=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!p.entityKey},hj=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!p.entityKey},O0=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!p.entityKey},Jqm=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!p.entityKey},
Jj=function(p,d,b,v,P){P=P===void 0?!1:P;
var M,X,a,F,h,O;return g.z(function(J){if(J.D==1)return M=g.aC(p,d),X=g.aC(p,"downloadStatusEntity"),g.y(J,BN(b,{mode:"readonly",Ib:!0},function(k){return g.w2.all([gO(k,M,d),gO(k,X,"downloadStatusEntity")])}),2);
a=J.U;F=a.length?a[0]:void 0;if(!F)return J.LX(0);h=kc3;if(O=a.length>1?a[1]:void 0){if(O.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!P)return J.return();O.downloadState=v}else O={key:X,downloadState:v};g.gK(F,h,O);return g.y(J,BN(b,{mode:"readwrite",Ib:!0},function(k){return g.w2.all([$4(k,F,d),$4(k,O,"downloadStatusEntity")])}),0)})},k2=function(p,d){return p.actionType===d.actionType&&p.entityKey===d.entityKey},n7=function(p,d){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!==
"TRANSFER_STATE_FAILED"){var b=g.qd(p.key).entityId;
a6({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:b,DZ:p,offlineModeType:d})}},rE=function(p){if(!p||!p.thumbnails)return[];
var d=[];p=g.u(p.thumbnails);for(var b=p.next();!b.done;b=p.next())b=b.value,b.url&&d.push(b.url);return d},naH=function(p,d,b){b=b===void 0?[]:b;
var v,P,M,X,a,F,h,O,J,k,n,r,Z;return g.z(function(C){if(C.D==1)return b.length?g.y(C,AJ(p,d),2):C.return([]);v=C.U;P=new Set;M=g.u(v);for(X=M.next();!X.done;X=M.next())if(a=X.value,F=a.id||a.key)h=g.qd(F).entityId,P.add(h);O=[];J=g.u(b);for(k=J.next();!k.done;k=J.next())n=k.value,r=n.offlineVideoData,Z=void 0,((Z=r)==null?0:Z.videoId)&&!P.has(r.videoId)&&O.push(n);return C.return(O)})},rqm=function(p,d,b){return new g.Vc(p,{cotn:d,
raw_player_response:b,download_media:!0,start:Infinity,disable_watch_next:!0})},fQ3=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},f7=function(p,d,b,v,P,M,X,a,F,h,O){this.entityType=p;
this.actionId=d;this.action=b;this.parentActionId=v;this.rootActionId=P===void 0?d:P;this.childActionIds=M;this.prereqActionId=X;this.postreqActionIds=a;this.hasChildActionFailed=h;this.retryScheduleIndex=0;this.D=O||Date.now();this.retryScheduleIndex=F||0},uP=function(p){if(!p.key)throw Error("Entity key is required.");
if(!p.actionProto)throw Error("OfflineOrchestrationAction is required.");var d=g.qd(p.key),b=g.qd(p.actionProto.entityKey);return new f7(b.entityType,d.entityId,p.actionProto,p.parentActionId,p.rootActionId,p.childActionIds,p.prereqActionId,p.postreqActionIds,p.retryScheduleIndex,p.hasChildActionFailed,Number(p.enqueueTimeSec)*1E3)},lP=function(p){return{key:g.aC(p.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:p.action,parentActionId:p.parentActionId,rootActionId:p.rootActionId,childActionIds:p.childActionIds,prereqActionId:p.prereqActionId,postreqActionIds:p.postreqActionIds,retryScheduleIndex:p.retryScheduleIndex,hasChildActionFailed:p.hasChildActionFailed,enqueueTimeSec:(p.D/1E3).toFixed()}},u8z=function(){var p;
return g.z(function(d){return d.D==1?g.y(d,vaQ(),2):(p=d.U)?d.return(p.delete("yt-player-local-img")):d.return(!0)})},s0=function(p){var d,b;
return g.z(function(v){if(v.D==1)return g.y(v,vaQ(),2);if(v.D!=3){d=v.U;if(!d)throw Error("Cache API not supported");return p.length?g.y(v,d.open("yt-player-local-img"),3):v.return()}b=v.U;return g.y(v,Promise.all(p.map(function(P){return b.delete(P)})),0)})},Zy=function(p){var d,b;
return g.z(function(v){if(v.D==1)return g.y(v,vaQ(),2);if(v.D!=3){d=v.U;if(!d)throw Error("Cache API not supported");return p.length?g.y(v,d.open("yt-player-local-img"),3):v.return()}b=v.U;return g.y(v,b.addAll(p),0)})},E0=function(p,d,b,v,P){var M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC;
return g.z(function(vm){switch(vm.D){case 1:return M=g.aC(p,"mainVideoEntity"),X=g.aC(p,"ytMainChannelEntity"),a=g.aC(p,"transfer"),F=g.aC(p,"videoDownloadContextEntity"),g.y(vm,BN(d,{mode:"readonly",Ib:!0},function(rQ){return g.w2.all([gO(rQ,M,"mainVideoEntity"),gO(rQ,X,"ytMainChannelEntity"),gO(rQ,a,"transfer"),gO(rQ,F,"videoDownloadContextEntity"),L6(rQ,"ytMainChannelEntity"),L6(rQ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=vm.U;O=g.u(h);J=O.next().value;k=O.next().value;n=O.next().value;r=O.next().value;Z=O.next().value;C=O.next().value;G=J;U=k;I=n;V=r;S=Z;B=C;if(!G&&!U){vm.LX(3);break}x=G?rE(G.thumbnail):[];if(!U){Pj=[];vm.LX(4);break}return g.y(vm,lQ3(U,S),5);case 5:Pj=vm.U;case 4:return qC=Pj,g.y(vm,s0(x.concat(qC)),3);case 3:pz=[];Q=g.aC(p,"downloadStatusEntity");W=g.u(B);for(l=W.next();!l.done;l=W.next())m=l.value,Yu=g.qd(m.key).entityId,Z2=uP(m),O6=g.qd(Z2.action.entityKey).entityId,Yu!==p&&O6!==p||k2(b,
m.actionProto)||pz.push(m.key);return g.y(vm,BN(d,{mode:"readwrite",Ib:!0},function(rQ){var N=pz.map(function(w){return ma(rQ,w)});
N.push(ma(rQ,M,{Yn:!0}));N.push(ma(rQ,Q,{Yn:!0}));return g.w2.all(N)}),7);
case 7:TC=(UW=V)==null?void 0:UW.offlineModeType,P&&(qY(P),P.offlineModeType&&(TC=P.offlineModeType)),n7(I,TC),MY(v,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.l$(vm)}})},EaF=function(p,d,b,v){var P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC,vm,rQ,N,w,c,t,D,b$,MC,Xu,H,h7,rw,oK,zC,J4,SX,OF;
return g.z(function($u){switch($u.D){case 1:return P=g.aC(p,"mainPlaylistEntity"),M=g.aC(p,"ytMainChannelEntity"),g.y($u,BN(d,{mode:"readonly",Ib:!0},function(VT){return g.w2.all([gO(VT,P,"mainPlaylistEntity"),gO(VT,M,"ytMainChannelEntity"),L6(VT,"mainPlaylistEntity"),L6(VT,"mainDownloadsListEntity"),L6(VT,"ytMainChannelEntity"),L6(VT,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=$u.U;a=g.u(X);F=a.next().value;h=a.next().value;O=a.next().value;J=a.next().value;k=a.next().value;n=a.next().value;r=F;Z=h;C=O;G=J;U=k;I=n;if(!r&&!Z){$u.LX(3);break}V=r?syQ(r):[];if(!Z){S=[];$u.LX(4);break}return g.y($u,lQ3(Z,U),5);case 5:S=$u.U;case 4:return B=S,g.y($u,s0(V.concat(B)),3);case 3:x=[];Pj=new Map;if(!r){$u.LX(7);break}return g.y($u,Zj3(r,C,G),8);case 8:x=$u.U;qC=g.u(x);for(pz=qC.next();!pz.done;pz=qC.next())Q=pz.value,Pj.set(Q,{videoId:Q,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.y($u,BN(d,{mode:"readonly",Ib:!0},function(VT){return g.w2.all([L6(VT,"transfer"),L6(VT,"videoDownloadContextEntity")])}),9);
case 9:W=$u.U;l=g.u(W);m=l.next().value;Yu=l.next().value;Z2=m;O6=Yu;UW=g.u(Z2);for(TC=UW.next();!TC.done;TC=UW.next())vm=TC.value,rQ=g.qd(vm.key).entityId,(N=Pj.get(rQ))&&vm&&(N.cotn=vm.cotn);w=g.u(O6);for(c=w.next();!c.done;c=w.next())t=c.value,D=g.qd(t.key).entityId,(b$=Pj.get(D))&&t&&(b$.offlineModeType=t.offlineModeType);case 7:MC=[];Xu=g.u(I);for(H=Xu.next();!H.done;H=Xu.next())h7=H.value,rw=g.qd(h7.key).entityId,oK=uP(h7),rw!==p&&oK.rootActionId!==p||k2(b,h7.actionProto)||MC.push(h7.key);zC=
g.aC(p,"mainPlaylistEntity");return g.y($u,BN(d,{mode:"readwrite",Ib:!0},function(VT){var aj=MC.map(function(zj){return ma(VT,zj)});
aj.push(ma(VT,zC,{Yn:!0}));return g.w2.all(aj)}),10);
case 10:if(!r){$u.LX(0);break}x.reverse();if(!x){$u.LX(0);break}J4=g.u(x);SX=J4.next();case 13:if(SX.done){$u.LX(0);break}OF=SX.value;return g.y($u,E0(OF,d,b,v,Pj.get(OF)),14);case 14:SX=J4.next(),$u.LX(13)}})},Ng6=function(p,d,b,v){var P,M,X,a,F,h,O,J,k;
return g.z(function(n){if(n.D==1)return P=g.aC("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),M=new Map,g.y(n,BN(p,{mode:"readwrite",Ib:!0},function(r){var Z=L6(r,"transfer"),C=L6(r,"offlineOrchestrationActionWrapperEntity"),G=L6(r,"videoDownloadContextEntity"),U=gO(r,P,"mainDownloadsListEntity");return g.w2.all([Z,C,G,U]).then(function(I){I=g.u(I);var V=I.next().value;var S=I.next().value;var B=I.next().value;var x=I.next().value;I=Ch2.map(function(qC){return swz(r,qC)});
S=g.u(S);for(var Pj=S.next();!Pj.done;Pj=S.next())Pj=Pj.value,k2(d,Pj.actionProto)||I.push(ma(r,Pj.key,{Yn:!0}));x&&(x.downloads=[],I.push($4(r,x,"mainDownloadsListEntity")));if(B)for(B=g.u(B),x=B.next();!x.done;x=B.next())x=x.value,S=g.qd(x.key).entityId,S=g.aC(S,"transfer"),M.set(S,x.offlineModeType);return g.w2.all(I).then(function(){return V})})}),2);
X=n.U;a=g.u(X);for(F=a.next();!F.done;F=a.next())h=F.value,n7(h,M.get(h.key)),O=g.qd(h.key).entityId,J={videoId:O,offlineDeleteReason:v,cotn:h.cotn,offlineModeType:M.get(h.key)},qY(J),k=g.aC(O,"mainVideoEntity"),MY(b,{entityKey:k,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(n,u8z(),0)})},syQ=function(p,d){var b=[];
if(p.thumbnailStyleData){p=g.u(p.thumbnailStyleData);for(var v=p.next();!v.done;v=p.next()){var P=void 0,M=void 0,X=void 0;b=b.concat(rE((P=v.value)==null?void 0:(M=P.value)==null?void 0:(X=M.collageThumbnail)==null?void 0:X.coverThumbnail))}}d=rE(d);return b.concat(d)},Zj3=function(p,d,b){var v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC;
return g.z(function(pz){v=[];P=new Set;if(b.length)for(M=g.u(b),X=M.next();!X.done;X=M.next())if(a=X.value,F=void 0,(F=a.downloads)==null?0:F.length)for(h=g.u(a.downloads),O=h.next();!O.done;O=h.next())J=O.value,J.videoItem&&(k=g.qd(J.videoItem).entityId,P.add(k));if(p.videos){n=g.u(p.videos);for(r=n.next();!r.done;r=n.next())Z=r.value,C=JSON.parse(g.qd(Z).entityId),C.videoId&&!P.has(C.videoId)&&v.push(C.videoId);G=g.u(d);for(U=G.next();!U.done;U=G.next())if(I=U.value,I.key!==p.key&&(V=I.videos))for(S=
g.u(V),B=S.next();!B.done;B=S.next())x=B.value,Pj=JSON.parse(g.qd(x).entityId),Pj.videoId&&(qC=v.indexOf(Pj.videoId),qC!==-1&&v.splice(qC,1))}return pz.return(v)})},lQ3=function(p,d){var b,v,P,M,X,a,F,h;
return g.z(function(O){b=rE(p.avatar);v=g.u(d);for(P=v.next();!P.done;P=v.next())if(M=P.value,M.id!==p.id)for(X=g.u(rE(M.avatar)),a=X.next();!a.done;a=X.next())F=a.value,h=b.indexOf(F),h!==-1&&b.splice(h,1);return O.return(b)})},Gcq=function(p){var d;
return g.z(function(b){d=g.L(p.frameworkUpdates,C7);return p.frameworkUpdates&&d?g.y(b,tU3(d),0):b.return()})},UVq=function(p){var d;
if((d=p.onResponseReceivedActions)!=null&&d.length){var b;p=(b=g.L(g.L(p.onResponseReceivedActions[0],wG2),g.QqR))==null?void 0:b.actions;if(p!=null&&p.length)return p}},cqW=function(p){var d,b,v;
return g.z(function(P){if(P.D==1)return p?g.y(P,TA(p,g.i1,"mainDownloadsListEntity"),2):P.return([]);d=P.U;return((b=d)==null?0:(v=b.downloads)==null?0:v.length)?P.return(d.downloads.map(function(M){var X;return(X=M.videoItem)!=null?X:""})):P.return([])})},IQ2=function(p,d){var b;
return g.z(function(v){return v.D==1?g.y(v,yq2(p,d),2):(b=v.U)?g.y(v,BN(p,{mode:"readwrite",Ib:!0},function(P){var M=[$4(P,b.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];b.mainDownloadsListEntity&&M.push($4(P,b.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.w2.all(M)}),0):v.LX(0)})},yq2=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I;
return g.z(function(V){if(V.D==1)return b=g.aC("main_downloads_library_id","mainDownloadsLibraryEntity"),v=g.aC("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(V,BN(p,{mode:"readonly",Ib:!0},function(S){return g.w2.all([gO(S,b,"mainDownloadsLibraryEntity"),gO(S,v,"mainDownloadsListEntity")])}),2);
P=V.U;M=g.u(P);X=M.next().value;a=M.next().value;F=X;h=a;F||(F={id:b});O=g.u(d);for(J=O.next();!J.done;J=O.next())if(k=J.value,k===g.i1){if(F.smartDownloadsList)return V.return();F.smartDownloadsList=k}else if(n=g.qd(k).entityType,r={},n==="mainPlaylistEntity"?r.playlistItem=k:n==="mainVideoEntity"&&(r.videoItem=k),!g.ID(r)){Z=void 0;if((Z=h)==null?0:Z.downloads){C=!1;G=g.u(h.downloads);for(U=G.next();!U.done;U=G.next())if(I=U.value,I.playlistItem===k||I.videoItem===k){C=!0;break}C||h.downloads.push(r)}else h=
{id:v,downloads:[r]};F.downloadsList=v}return V.return({mainDownloadsLibraryEntity:F,mainDownloadsListEntity:h})})},z66=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C;
return g.z(function(G){if(G.D==1)return b=g.aC("main_downloads_library_id","mainDownloadsLibraryEntity"),v=g.aC("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(G,BN(p,{mode:"readonly",Ib:!0},function(U){return g.w2.all([gO(U,b,"mainDownloadsLibraryEntity"),gO(U,v,"mainDownloadsListEntity"),gO(U,g.i1,"mainDownloadsListEntity")])}),2);
P=G.U;M=g.u(P);X=M.next().value;a=M.next().value;F=M.next().value;h=X;O=a;J=F;if(!h)return G.LX(0);if(d===g.i1&&((k=J)==null?0:k.downloads))J.downloads=[];else if((n=O)==null?0:n.downloads)for(r=g.qd(d).entityType,Z=0;Z<O.downloads.length;Z++)if(C=O.downloads[Z],r==="mainVideoEntity"&&C.videoItem===d){O.downloads.splice(Z,1);break}else if(r==="mainPlaylistEntity"&&C.playlistItem===d){O.downloads.splice(Z,1);break}return g.y(G,BN(p,{mode:"readwrite",Ib:!0},function(U){var I=[$4(U,h,"mainDownloadsLibraryEntity")];
O&&I.push($4(U,O,"mainDownloadsListEntity"));J&&I.push($4(U,J,"mainDownloadsListEntity"));return g.w2.all(I)}),0)})},NY=function(p,d){var b,v,P,M,X,a,F,h,O,J,k;
return g.z(function(n){if(n.D==1)return b=g.aC(d,"transfer"),v=g.aC(d,"videoDownloadContextEntity"),g.y(n,BN(p,{mode:"readonly",Ib:!0},function(r){return g.w2.all([gO(r,b,"transfer"),gO(r,v,"videoDownloadContextEntity")])}),2);
P=n.U;M=g.u(P);X=M.next().value;a=M.next().value;F=X;h=a;k={videoId:d,cotn:(O=F)==null?void 0:O.cotn,offlineModeType:(J=h)==null?void 0:J.offlineModeType};return n.return(k)})},G6=function(p,d,b,v,P){var M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj;
return g.z(function(qC){switch(qC.D){case 1:return M=g.aC(p,"musicTrack"),X=g.aC(p,"transfer"),g.y(qC,BN(d,{mode:"readonly",Ib:!0},function(pz){return g.w2.all([gO(pz,M,"musicTrack"),gO(pz,X,"transfer"),L6(pz,"musicTrack"),L6(pz,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:a=qC.U;F=g.u(a);h=F.next().value;O=F.next().value;J=F.next().value;k=F.next().value;n=h;r=O;Z=J;C=k;if(!n){qC.LX(3);break}return g.y(qC,jyz(n,Z),4);case 4:return G=qC.U,g.y(qC,s0(G),3);case 3:U=[];I=g.u(C);for(V=I.next();!V.done;V=I.next())S=V.value,B=g.qd(S.key).entityId,x=uP(S),Pj=g.qd(x.action.entityKey).entityId,B!==p&&Pj!==p||k2(b,S.actionProto)||U.push(S.key);return g.y(qC,BN(d,{mode:"readwrite",Ib:!0},function(pz){var Q=U.map(function(W){return ma(pz,W)});
Q.push(ma(pz,M,{Yn:!0}));return g.w2.all(Q)}),6);
case 6:n7(r),P&&qY(P),MY(v,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.l$(qC)}})},wE=function(p,d,b,v,P){var M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC,vm,rQ,N,w,c;
return g.z(function(t){switch(t.D){case 1:return M=g.aC(p,d),X=g.aC("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(t,BN(b,{mode:"readonly",Ib:!0},function(D){return g.w2.all([gO(D,M,d),gO(D,X,"musicDownloadsLibraryEntity"),L6(D,d),L6(D,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:a=t.U;F=g.u(a);h=F.next().value;O=F.next().value;J=F.next().value;k=F.next().value;n=h;r=O;Z=J;C=k;if(!n){t.LX(3);break}return g.y(t,jyz(n,Z),4);case 4:return G=t.U,g.y(t,s0(G),3);case 3:U=[];I=new Map;if(!n){t.LX(6);break}return g.y(t,tiC(n,Z,r),7);case 7:U=t.U;V=g.u(U);for(S=V.next();!S.done;S=V.next())B=S.value,x=g.qd(B).entityId,I.set(x,{videoId:x,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.y(t,AJ(b,"transfer"),8);case 8:for(Pj=t.U,qC=g.u(Pj),
pz=qC.next();!pz.done;pz=qC.next())Q=pz.value,W=g.qd(Q.key).entityId,(l=I.get(W))&&Q&&(l.cotn=Q.cotn);case 6:m=[];Yu=g.u(C);for(Z2=Yu.next();!Z2.done;Z2=Yu.next())O6=Z2.value,UW=g.qd(O6.key).entityId,TC=uP(O6),UW!==p&&TC.rootActionId!==p||k2(v,O6.actionProto)||m.push(O6.key);vm=g.aC(p,d);return g.y(t,BN(b,{mode:"readwrite",Ib:!0},function(D){var b$=m.map(function(MC){return ma(D,MC)});
b$.push(ma(D,vm,{Yn:!0}));return g.w2.all(b$)}),9);
case 9:if(!n){t.LX(0);break}U.reverse();if(!U.length){t.LX(0);break}rQ=g.u(U);N=rQ.next();case 12:if(N.done){t.LX(0);break}w=N.value;c=g.qd(w).entityId;if(!c){t.LX(13);break}return g.y(t,G6(c,b,v,P,I.get(c)),13);case 13:N=rQ.next(),t.LX(12)}})},U0=function(p,d,b){var v,P,M,X,a,F,h;
return g.z(function(O){if(O.D==1)return g.y(O,BN(p,{mode:"readwrite",Ib:!0},function(J){var k=L6(J,"transfer"),n=L6(J,"offlineOrchestrationActionWrapperEntity");return g.w2.all([k,n]).then(function(r){r=g.u(r);var Z=r.next().value;var C=r.next().value;r=ijq.map(function(V){return swz(J,V)});
C=g.u(C);for(var G=C.next();!G.done;G=C.next()){G=G.value;var U=g.qd(G.actionProto.entityKey).entityType==="musicTrack",I=G.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";k2(d,G.actionProto)||U&&(!U||I)||r.push(ma(J,G.key,{Yn:!0}))}return g.w2.all(r).then(function(){return Z})})}),2);
v=O.U;P=g.u(v);for(M=P.next();!M.done;M=P.next())X=M.value,n7(X),a=g.qd(X.key).entityId,F={videoId:a,offlineDeleteReason:void 0,cotn:X.cotn},qY(F),h=g.aC(a,"musicTrack"),MY(b,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(O,u8z(),0)})},Hj4=function(p){for(var d,b=g.u(p.additionalMetadatas),v=b.next();!v.done;v=b.next())v=v.value,v.offlineMusicVideoData&&(d=v.offlineMusicVideoData);
var P,M,X,a,F;return{id:g.aC(p.videoId,"musicTrack"),videoId:p.videoId,title:p.title,thumbnailDetails:p.thumbnail,lengthMs:String(Number(p.lengthSeconds)*1E3),albumTitle:(P=d)==null?void 0:P.releaseTitle,musicVideoType:(M=d)==null?void 0:M.musicVideoType,contentRating:{explicitType:(X=d)==null?void 0:X.explicitType},artistNames:((a=d)==null?void 0:a.byline)||((F=d)==null?void 0:F.channelName),downloadMetadata:g.aC(p.videoId,"musicTrackDownloadMetadataEntity")}},tiC=function(p,d,b){var v,P,M,X,a,F,
h,O,J,k,n,r,Z,C,G,U,I,V;
return g.z(function(S){v=[];P=new Set;if((M=b)==null?0:(X=M.downloadedTracks)==null?0:X.length)for(a=g.u(b.downloadedTracks),F=a.next();!F.done;F=a.next())h=F.value,P.add(h);if(p.tracks){O=g.u(p.tracks);for(J=O.next();!J.done;J=O.next())k=J.value,P.has(k)||v.push(k);n=g.u(d);for(r=n.next();!r.done;r=n.next())if(Z=r.value,Z.id!==p.id&&(C=Z.tracks))for(G=g.u(C),U=G.next();!U.done;U=G.next())I=U.value,V=v.indexOf(I),V!==-1&&v.splice(V,1)}return S.return(v)})},jyz=function(p,d){var b,v,P,M,X,a,F,h;
return g.z(function(O){b=rE(p.thumbnailDetails);v=g.u(d);for(P=v.next();!P.done;P=v.next())if(M=P.value,M.id!==p.id)for(X=g.u(rE(M.thumbnailDetails)),a=X.next();!a.done;a=X.next())F=a.value,h=b.indexOf(F),h!==-1&&b.splice(h,1);return O.return(b)})},DVz=function(p,d){var b,v,P,M,X,a,F,h,O;
return g.z(function(J){if(J.D==1)return b=g.aC("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(J,TA(p,b,"musicDownloadsLibraryEntity"),2);(v=J.U)||(v={id:b});P=g.qd(d).entityType;P==="musicTrack"?(M=v.downloadedTracks)!=null&&M.includes(d)||(v.downloadedTracks=((X=v.downloadedTracks)!=null?X:[]).concat(d)):P==="musicPlaylist"?(a=v.downloadedPlaylists)!=null&&a.includes(d)||(v.downloadedPlaylists=((F=v.downloadedPlaylists)!=null?F:[]).concat(d)):P!=="musicAlbumRelease"||(h=v.downloadedAlbumReleases)!=
null&&h.includes(d)||(v.downloadedAlbumReleases=((O=v.downloadedAlbumReleases)!=null?O:[]).concat(d));return g.y(J,RX(p,v,"musicDownloadsLibraryEntity"),0)})},Viz=function(p,d){var b,v,P,M,X,a,F;
return g.z(function(h){if(h.D==1)return b=g.aC("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(h,TA(p,b,"musicDownloadsLibraryEntity"),2);v=h.U;if(!v)return h.LX(0);P=g.qd(d).entityType;P==="musicTrack"?M=v.downloadedTracks:P==="musicPlaylist"&&(M=v.downloadedPlaylists);if((X=M)==null?0:X.length)for(a=0;a<M.length;a++)if(F=M[a],F===d){M.splice(a,1);break}return g.y(h,RX(p,v,"musicDownloadsLibraryEntity"),0)})},e6z=function(p){var d=p.videos;
p=[];var b=[];if(d){d=g.u(d);for(var v=d.next();!v.done;v=d.next()){var P=v.value.offlineVideoData.videoId;v=g.aC(P,"musicTrack");P=g.aC(P,"musicTrackDownloadMetadataEntity");p.push(v);b.push(P)}}return{UK:p,Df:b}},c8=function(p,d,b){d={track:Hj4(d)};
b&&(d.playlistId=b);if(p=g.L(p.actionMetadata,S1R))d.maximumDownloadQuality=p.maximumDownloadQuality;return{musicTrackEntityActionMetadata:d}},gaQ=function(p){var d,b,v,P,M,X,a,F;
return g.z(function(h){switch(h.D){case 1:return d=g.XN(),b=gNQ(p),v=g.d5(Y1X),g.sW(h,2),M={qG:!0},g.y(h,g.Bs(d,b,v,void 0,M),4);case 4:P=h.U;g.EW(h,3);break;case 2:X=g.Cz(h);if(X instanceof g.v0)throw a="GetOffline network manager error: "+X.message,v8(a,X),Error(a);v8("GetOffline fetch request error",X);throw Error("GetOffline fetch request error");case 3:F=yW(P);if(!P)throw v8("Network request failed"),Error("Network request failed");if(F!==void 0)I6(F);else if(!P.videos||!P.videos.length)throw v8("No data"),
Error("No data");return h.return(P.videos.map(function(O){return O.offlineVideoData}))}})},LpH=function(p){var d,b,v,P,M,X,a,F;
return g.z(function(h){switch(h.D){case 1:return d=g.XN(),b=LUQ(p),v=g.d5(Y1X),g.sW(h,2),M={qG:!0},g.y(h,g.Bs(d,b,v,void 0,M),4);case 4:P=h.U;g.EW(h,3);break;case 2:X=g.Cz(h);if(X instanceof g.v0)throw a="GetOffline network manager error for playlist: "+X.message,v8(a,X),Error(a);v8("GetOffline fetch request error for playlist",X);throw Error("GetOffline fetch request error for playlist");case 3:F=yW(P);if(!P)throw v8("Network request failed for playlist"),Error("Network request failed for playlist");
if(F!==void 0)I6(F,"playlist");else if(!P.playlists||!P.playlists.length)throw v8("No data for playlist"),Error("No data for playlist");return h.return(P.playlists.map(function(O){return O.offlinePlaylistData}))}})},$VR=function(p,d,b,v){var P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6;
return g.z(function(UW){switch(UW.D){case 1:return g.y(UW,WN(),2);case 2:P=UW.U;if(!P)return UW.return([]);M=[];if((X=v)==null?0:X.length){M=v;UW.LX(3);break}return g.y(UW,AJ(P,"mainPlaylistEntity"),4);case 4:M=UW.U;case 3:if(!M.length)return UW.return([]);a=[];F=Date.now()/1E3;h=g.u(M);O=h.next();case 5:if(O.done)return a.length?g.y(UW,QyX(a),10):UW.return([]);J=O.value;if(!J.downloadState){k=void 0;UW.LX(8);break}return g.y(UW,TA(P,J.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:k=
UW.U;case 8:n=k;r=void 0;C=(Z=(r=J)==null?void 0:r.entityMetadata)&&Z.nextAutoRefreshIntervalSeconds?Number(Z.nextAutoRefreshIntervalSeconds):NaN;G=Number.isNaN(C)?p:C;I=U=void 0;V=((U=n)==null?0:U.lastSyncedTimestampMillis)?Number((I=n)==null?void 0:I.lastSyncedTimestampMillis)/1E3:0;B=S=void 0;x=((S=n)==null?0:S.addedTimestampMillis)?Number((B=n)==null?void 0:B.addedTimestampMillis)/1E3:0;if(b||!Z||V+G<=F){Pj=[];qC=void 0;if((qC=J.videos)==null?0:qC.length)for(pz=g.u(J.videos),Q=pz.next();!Q.done;Q=
pz.next())W=Q.value,l=JSON.parse(g.qd(W).entityId),l.videoId&&Pj.push(l.videoId);m="0";Z&&(Yu=void 0,m=String(Number((Yu=Z.offlineLastModifiedTimestampSeconds)!=null?Yu:0).toFixed()));Z2={playlistId:J.playlistId,videoIds:Pj,offlineLastModifiedTimestamp:m,autoSync:d,offlineDateAddedTimestamp:String(x.toFixed())};a.push(Z2)}O=h.next();UW.LX(5);break;case 10:return O6=UW.U,UW.return(O6)}})},mVC=function(){var p,d,b,v,P;
return g.z(function(M){if(M.D==1)return g.y(M,WN(),2);if(M.D!=3)return(p=M.U)?g.y(M,AJ(p,"refresh"),3):M.return(!1);d=M.U;if((b=d[0])==null||!b.refreshTime)return M.return(!1);v=Number(d[0].refreshTime);P=Date.now()/1E3;return M.return(isFinite(v)&&P>=v)})},xV4=function(p,d){var b,v,P;
return g.z(function(M){switch(M.D){case 1:return g.sW(M,2),g.y(M,Kp4(p,d),4);case 4:return v=M.U,g.y(M,Gcq(v),5);case 5:b=UVq(v);g.EW(M,3);break;case 2:P=g.Cz(M),v8("getAndProcessSmartDownloadsResponse request or processing error",P);case 3:return M.return(b)}})},BgQ=function(p,d,b,v){var P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6;
return g.z(function(UW){switch(UW.D){case 1:return g.y(UW,WN(),2);case 2:P=UW.U;if(!P)return UW.return([]);M=[];if((X=v)==null?0:X.length){M=v;UW.LX(3);break}return g.y(UW,AJ(P,"musicPlaylist"),4);case 4:M=UW.U;case 3:if(!M.length)return UW.return([]);a=[];F=Date.now()/1E3;h=g.u(M);O=h.next();case 5:if(O.done)return a.length?g.y(UW,QyX(a),10):UW.return([]);J=O.value;k=void 0;r=(n=(k=J)==null?void 0:k.entityMetadata)&&n.nextAutoRefreshIntervalSeconds?Number(n.nextAutoRefreshIntervalSeconds):NaN;Z=
Number.isNaN(r)?p:r;G=C=0;U="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!J.downloadMetadata){UW.LX(8);break}return g.y(UW,TA(P,J.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:I=UW.U,S=V=void 0,C=Number((S=(V=I)==null?void 0:V.addedTimestampMillis)!=null?S:"0")/1E3,x=B=void 0,G=Number((x=(B=I)==null?void 0:B.lastModifiedTimestampMillis)!=null?x:"0")/1E3,qC=Pj=void 0,U=(qC=(Pj=I)==null?void 0:Pj.syncState)!=null?qC:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:pz=void 0;if(b||U!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!n||Number((pz=n.lastSyncedTimestampSeconds)!=null?pz:0)+Z<=F){Q=[];W=void 0;if((W=J.tracks)==null?0:W.length)for(l=g.u(J.tracks),m=l.next();!m.done;m=l.next())Yu=m.value,Q.push(g.qd(Yu).entityId);Z2={playlistId:J.playlistId,videoIds:Q,offlineLastModifiedTimestamp:String(G.toFixed()),autoSync:d,offlineDateAddedTimestamp:String(C.toFixed())};a.push(Z2)}O=h.next();UW.LX(5);break;case 10:return O6=UW.U,UW.return(O6)}})},Kp4=function(p,d){var b,v,P,M,X,a,F,h,O,J;
return g.z(function(k){switch(k.D){case 1:return b=g.XN(),g.y(k,WN(),2);case 2:v=k.U;if(!v){k.LX(3);break}return g.y(k,Ry4(v),4);case 4:P=k.U;case 3:var n=P;M={context:g.AI(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:p},offlineClientState:n,clientStateRequestData:{preferredFormatType:d}}}};X=g.d5(R6W);g.sW(k,5);F={qG:!0};return g.y(k,g.Bs(b,M,X,void 0,F),7);case 7:a=k.U;g.EW(k,6);break;case 5:h=g.Cz(k);if(h instanceof g.v0)throw O=
"DPS network manager error for smart downloads: "+h.message,v8(O,h),Error(O);v8("DPS fetch request error for smart downloads",h);throw Error("DPS fetch request error for smart downloads");case 6:J=yW(a);if(a)J!==void 0&&I6(J,"smart downloads");else throw v8("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return k.return(a)}})},Aq2=function(p,d){var b,v,P,M,X,a,F,h;
return g.z(function(O){switch(O.D){case 1:return b=g.XN(),v={context:g.AI(),videoPlaybackPositionEntities:p,lastSyncTimestampUsec:d},P=g.d5(Tg4),g.sW(O,2),X={qG:!0},g.y(O,g.Bs(b,v,P,void 0,X),4);case 4:M=O.U;g.EW(O,3);break;case 2:a=g.Cz(O);if(a instanceof g.v0)throw F="VPPS network manager error: "+a.message,v8(F,a),Error(F);v8("VPPS fetch request error",a);throw Error("VPPS fetch request error");case 3:h=yW(M);if(M)h!==void 0&&I6(h,"position sync");else throw v8("Network request failed for position sync"),
Error("Network request failed for position sync");return O.return(M)}})},plz=function(p,d,b){var v,P,M,X,a,F,h,O;
return g.z(function(J){switch(J.D){case 1:v=g.XN();var k=b.refreshData,n=b.isEnqueuedForExpiredStreamUrlRefetch,r=b.JU,Z=b.offlineSourceData,C=b.mediaCapabilities,G={entityKey:p};k&&(G.refreshData=k);n&&(G.isExpiredStreamUrlRefetch=n);r&&(G.downloadParameters=r);Z&&(G.offlineSourceData=Z);k={context:g.Tf(d),signatureTimestamp:20130,videos:[G]};C&&(k.mediaCapabilities=C);P=k;M=g.d5(WpW);g.sW(J,2);a={qG:!0};return g.y(J,g.Bs(v,P,M,void 0,a),4);case 4:X=J.U;g.EW(J,3);break;case 2:F=g.Cz(J);if(F instanceof
g.v0)throw h="GetPDE network manager error: "+F.message,v8(h,F),Error(h);v8("GetPDE fetch request error",F);throw Error("GetPDE fetch request error");case 3:O=yW(X);if(X)O!==void 0&&I6(O,"PDE");else throw v8("Network request failed for PDE"),Error("Network request failed for PDE");return J.return(X)}})},yW=function(p){var d;
return(d=p.errorMetadata)==null?void 0:d.status},I6=function(p,d){d=d?" for "+d:"";
if(p===0)throw p="Empty response body"+d,v8(p),Error(p);p="Response with error"+d;v8(p);throw Error(p);},QyX=function(p){var d,b,v,P,M,X,a,F;
return g.z(function(h){switch(h.D){case 1:return d=g.XN(),b=Qwz(p),v=g.d5(deW),g.sW(h,2),M={qG:!0},g.y(h,g.Bs(d,b,v,void 0,M),4);case 4:P=h.U;g.EW(h,3);break;case 2:X=g.Cz(h);if(X instanceof g.v0)throw a="offlinePlaylistSyncCheck network manager error: "+X.message,v8(a,X),Error(a);v8("offlinePlaylistSyncCheck fetch request error",X);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:F=yW(P);if(!P)throw v8("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(F!==void 0)I6(F,"playlist sync");else if(!P.offlinePlaylistSyncCheckDatas||!P.offlinePlaylistSyncCheckDatas.length)throw v8("No data for playlist sync"),Error("No data for playlist sync");return h.return(P.offlinePlaylistSyncCheckDatas.map(function(O){return O.offlinePlaylistSyncCheckData}))}})},z6=function(p){this.D=p},bPC=function(p,d){var b,v,P,M,X,a;
return g.z(function(F){switch(F.D){case 1:b=new Map,v=g.u(d),P=v.next();case 2:if(P.done){F.LX(4);break}M=P.value;X=b;a=X.set;return g.y(F,p.U(M),5);case 5:a.call(X,M,F.U);P=v.next();F.LX(2);break;case 4:return F.return(b)}})},jM=function(p,d,b,v,P,M){d=g.aC(d,b);
v=Object.assign({},M,{priority:v,retryScheduleIntervalsInSeconds:P});return{actionType:p,entityKey:d,actionMetadata:v}},tj=function(p,d,b,v,P,M){this.status=p;
this.D=d;this.V=b;this.U=v;this.B=P;this.downloadState=M},vIz=function(p,d,b){this.D=p;
this.gE=d;this.B=b},Xl6=function(p,d){var b,v,P,M,X,a,F,h,O;
return g.z(function(J){switch(J.D){case 1:return b=d.entityKey,P=(v=g.L(d.actionMetadata,iP))==null?void 0:v.isEnqueuedForExpiredStreamUrlRefetch,g.sW(J,2),M=void 0,g.y(J,PAR(p,d),4);case 4:M=J.U;g.sW(J,5);var k=(k=g.L(d.actionMetadata,iP))?{maximumDownloadQuality:k.maximumDownloadQuality}:void 0;return g.y(J,plz(b,p.gE,{isEnqueuedForExpiredStreamUrlRefetch:P,JU:k,offlineSourceData:M}),7);case 7:X=J.U;g.EW(J,6,2);break;case 5:return g.Cz(J,2),a=o6(d)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",v8("PDE handleAdd error"),J.return(H8(d,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",a,"DOWNLOAD_STATE_FAILED"));case 6:return g.y(J,MHm(p,X,d),8);case 8:return J.return(H8(d,!0,X.orchestrationActions));case 2:return F=g.Cz(J),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.lp&&F.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v8("PDE handleAdd error"),J.return(H8(d,!1,void 0,h,O,"DOWNLOAD_STATE_FAILED"))}})},oIW=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC;
return g.z(function(pz){switch(pz.D){case 1:return b=d.entityKey,v=g.qd(b).entityId,g.y(pz,BN(p.D,{mode:"readonly",Ib:!0},function(Q){var W=gO(Q,b,"playbackData"),l=gO(Q,g.aC(v,"offlineVideoPolicy"),"offlineVideoPolicy");Q=gO(Q,g.aC(v,"transfer"),"transfer");return g.w2.all([W,l,Q])}),2);
case 2:P=pz.U;M=g.u(P);X=M.next().value;a=M.next().value;F=M.next().value;h=X;O=a;J=F;if(!h||!O)return pz.return(H8(d,!0));k=[];Z=((r=h)==null?0:r.playerResponseJson)?JSON.parse(h.playerResponseJson):null;if(!(J&&Z&&p.gE.T("html5_refresh_deprecated_downloads"))){pz.LX(3);break}n=qg6(p,Z,J);return g.y(pz,afF(p,J),4);case 4:k=pz.U;case 3:C={lastPlayerResponseTimestampSeconds:h.playerResponseTimestamp,offlineToken:O.offlineToken,formatIds:k};G={};if((U=J)==null?0:U.maximumDownloadQuality)G.maximumDownloadQuality=
J.maximumDownloadQuality;g.sW(pz,5);I=void 0;return g.y(pz,PAR(p,d),7);case 7:return I=pz.U,g.sW(pz,8),g.y(pz,plz(b,p.gE,{refreshData:C,JU:G,offlineSourceData:I,mediaCapabilities:n}),10);case 10:V=pz.U;g.EW(pz,9,5);break;case 8:return g.Cz(pz,5),S=o6(d)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",v8("PDE handleRefresh error"),pz.return(H8(d,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",S,
"DOWNLOAD_STATE_FAILED"));case 9:return g.y(pz,MHm(p,V,d),11);case 11:return pz.return(H8(d,!0,V.orchestrationActions));case 5:return B=g.Cz(pz),x="PDE handleRefresh error",B instanceof Error&&(x="PDE handleRefresh error: "+B.message),Pj="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",qC="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.lp&&B.type==="QUOTA_EXCEEDED"&&(Pj="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",qC="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v8(x),pz.return(H8(d,!1,void 0,Pj,qC,"DOWNLOAD_STATE_FAILED"))}})},PAR=function(p,d){var b,v,P,M;
return g.z(function(X){if(X.D==1)return b=g.qd(d.entityKey).entityId,v=g.aC(b,"videoDownloadContextEntity"),g.y(X,TA(p.D,v,"videoDownloadContextEntity"),2);P=X.U;return(M=P)!=null&&M.offlineModeType?X.return({offlineModeType:P.offlineModeType}):X.return(void 0)})},MHm=function(p,d,b){var v,P,M,X,a;
return g.z(function(F){if(F.D==1){if(!d.frameworkUpdates||!g.L(d.frameworkUpdates,C7))return F.return();if(!(g.L(d.frameworkUpdates,C7).mutations&&g.L(d.frameworkUpdates,C7).mutations.length>0&&g.L(d.frameworkUpdates,C7).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return F.LX(2);v=g.qd(g.L(d.frameworkUpdates,C7).mutations[0].entityKey).entityId;return g.y(F,NY(p.D,v),3)}if(F.D!=2){P=F.U;M=g.L(b.actionMetadata,iP);if(a=(X=M)==null?void 0:X.playlistId)P.playlistId=a;P.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.QJ(p.gE)?g.y(F,E0(v,p.D,b,p.B,P),2):g.eo(p.gE)?g.y(F,G6(v,p.D,b,p.B),2):F.LX(2)}return g.y(F,tU3(g.L(d.frameworkUpdates,C7)),0)})},H8=function(p,d,b,v,P,M){return new tj(d?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",o6(p),b,v,P,M)},qg6=function(p,d,b){d=rqm(p.gE,b.cotn,d);
b=g.ds(d);return g.GRK(d,b,p.gE)},afF=function(p,d){var b,v,P,M,X,a,F,h,O,J,k;
return g.z(function(n){if(n.D==1)return b=[],g.y(n,BN(p.D,{mode:"readonly",Ib:!0},function(r){var Z=[],C=d.offlineVideoStreams;if(C){C=g.u(C);for(var G=C.next();!G.done;G=C.next())Z.push(gO(r,G.value,"offlineVideoStreams"))}return g.w2.all(Z)}),2);
if(v=n.U)for(P=g.u(v),M=P.next();!M.done;M=P.next())if(X=M.value,a=void 0,(a=X)==null?0:a.streamsProgress)for(F=X.streamsProgress,h=0;h<F.length;h++)O=F[h],J=JSON.parse(O.formatStreamBytes),k={itag:J.itag,lmt:J.lastModified,xtags:J.xtags},b.push(k);return n.return(b)})},FvW=function(p,d){this.D=p;
this.gE=d},hq3=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n;
return g.z(function(r){switch(r.D){case 1:return b=o6(d),g.y(r,AJ(p.D,"videoPlaybackPositionEntity"),2);case 2:v=r.U;if(v.length===0)return r.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));g.sW(r,3);return g.y(r,e1.getInstance(),5);case 5:P=r.U;if(!P)throw Error("prefStorage is undefined");return g.y(r,P.get("psi"),6);case 6:return M=r.U,F=(a=(X=M)==null?void 0:X.WK)!=null?a:"0",g.y(r,Aq2(v,F),7);case 7:return h=r.U,O={isPaused:h.watchHistoryPaused,WK:h.syncTimestampUsec},g.y(r,P.set("psi",
O),8);case 8:if(O.isPaused){r.LX(9);break}J=g.L(h.frameworkUpdates,C7);if(!h.frameworkUpdates||!J){r.LX(9);break}return g.y(r,tU3(J),9);case 9:g.EW(r,4);break;case 3:return k=g.Cz(r),n="PPE handleRefresh error: "+(k instanceof Error?k.message:"unknown error"),v8(n),r.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return r.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b))}})},Je2=function(p,d){var b,v,P,M,X,a,F,h;
return g.z(function(O){switch(O.D){case 1:return b=o6(d),v=g.qd(d.entityKey).entityId,g.sW(O,2),g.y(O,e1.getInstance(),4);case 4:P=O.U;if(!P)throw Error("prefStorage is undefined");return g.y(O,P.get("psi"),5);case 5:M=O.U;X=g.L(d.actionMetadata,OPQ);if(((a=M)==null?void 0:a.isPaused)!==!1||(F=X)==null||!F.lastPlaybackPositionSeconds){O.LX(6);break}h={key:g.aC(v,"videoPlaybackPositionEntity"),videoId:v,lastPlaybackPositionSeconds:X.lastPlaybackPositionSeconds};return g.y(O,RX(p.D,h,"videoPlaybackPositionEntity"),
6);case 6:g.EW(O,3);break;case 2:return g.Cz(O),O.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b))}})},kIF=function(p,d){var b,v,P;
return g.z(function(M){switch(M.D){case 1:b=o6(d);g.sW(M,2);v=g.qd(d.entityKey).entityId;if(v==="!*$_ALL_ENTITIES_!*$")return g.y(M,c1q(p.D),5);P=g.aC(v,"videoPlaybackPositionEntity");return g.y(M,UM6(p.D,P),5);case 5:g.EW(M,3);break;case 2:return g.Cz(M),M.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b))}})},nIX=function(p,d){this.api=p;
this.D=d;this.logger=new g.T$("woffle");this.U=!1;this.Up={b6:this.b6};this.logger.debug("Initialized OfflineMediaManager")},reC=function(p){return g.z(function(d){return d.return(YPR(p))})},ffX=function(p){var d;
return g.z(function(b){if(b.D==1)return g.y(b,g.Ta$(p),2);d=b.U;return b.return(d.filter(function(v){return!!v.url}).map(function(v){return v.url}))})},Dy=function(p,d){var b=g.Cu(d);
if(b===1||b===0)return Promise.resolve();(b=uJQ(p,d))&&b.stopVideo();p.B=0;return reC(d)},VW=function(p,d,b,v){b=b===void 0?!1:b;
v=v===void 0?!0:v;var P=typeof d==="string"?d:d.videoDetails.videoId;g.Cu(P)===2&&((d=uJQ(p,P))?d.stopVideo():p.logger.info(function(){return"Corresponding player for "+P+" not found. Pausing anyway"}),g.NZ(P,2),p.B=2,b?lfQ(p.D):v&&s_Q(p.D))},uJQ=function(p,d){var b;
return((b=p.player)==null?void 0:b.getVideoData().videoId)===d?p.player:null},ZPH=function(p,d,b){d.getPlayerResponse();
g.NZ(d.videoId,2);p.B=2;p.U=!1;var v;(v=p.player)==null||v.dispose();p.player=p.api.cI(d);d={};p.player.uc((d.localmediachange=p.SN,d.signatureexpired=p.K_,d.statechange=p.b9J,d),p);var P=p.b6(b);p.player.rZ(g.WB(P,P,!0,"m"),!1);p.logger.debug(function(){return"Starting headless playback with quality: "+P});
p.player.SV(!1)},EI6=function(p,d){this.D=p;
this.gE=d},NN6=function(p,d){var b,v;
return g.z(function(P){switch(P.D){case 1:return b=o6(d),g.y(P,TA(p.D,d.entityKey,"transfer"),2);case 2:if(v=P.U)return P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));g.sW(P,3);return g.y(P,CAz(p,d),5);case 5:g.EW(P,4);break;case 3:return g.Cz(P),P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b))}})},GIq=function(p,d){var b,v;
return g.z(function(P){switch(P.D){case 1:return b=o6(d),g.y(P,TA(p.D,d.entityKey,"transfer"),2);case 2:v=P.U;if(!v||v.transferState!=="TRANSFER_STATE_COMPLETE")return P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));g.sW(P,3);return g.y(P,CAz(p,d,!0),5);case 5:g.EW(P,4);break;case 3:return g.Cz(P),P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b))}})},wlR=function(p,d){var b,v,P,M,X,a,F,h,O,J;
return g.z(function(k){switch(k.D){case 1:return b=o6(d),v=g.qd(d.entityKey).entityId,g.y(k,BN(p.D,{mode:"readonly",Ib:!0},function(n){var r=gO(n,d.entityKey,"transfer");n=gO(n,g.aC(v,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w2.all([r,n])}),2);
case 2:P=k.U;M=g.u(P);X=M.next().value;a=M.next().value;F=X;h=a;if(!F||F.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return k.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));g.sW(k,3);F.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.y(k,RX(p.D,F,"transfer"),5);case 5:O=g.qd(F.key).entityId;a6({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:O,DZ:F,offlineModeType:(J=h)==null?void 0:J.offlineModeType});g.EW(k,
4);break;case 3:return g.Cz(k),k.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b))}})},CAz=function(p,d,b){b=b===void 0?!1:b;
var v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G;return g.z(function(U){switch(U.D){case 1:return v=g.L(d.actionMetadata,UeH),P=g.qd(d.entityKey).entityId,M=g.aC(P,"downloadStatusEntity"),g.y(U,BN(p.D,{mode:"readonly",Ib:!0},function(I){var V=gO(I,M,"downloadStatusEntity");I=gO(I,g.aC(P,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w2.all([V,I])}),2);
case 2:return X=U.U,a=g.u(X),F=a.next().value,h=a.next().value,O=F,J=h,k="TRANSFER_STATE_TRANSFER_IN_QUEUE",((n=O)==null?void 0:n.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(k="TRANSFER_STATE_PAUSED_BY_USER"),C={key:d.entityKey,transferState:k,cotn:g.GW(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(r=v)==null?void 0:r.maximumDownloadQuality,preferredAudioTrack:(Z=v)==null?void 0:Z.preferredAudioTrack,transferRetryCount:0,isRefresh:b,hasLoggedFirstStarted:!1},g.y(U,BN(p.D,
{mode:"readwrite",Ib:!0},function(I){var V=[];b&&V.push(ma(I,g.aC(P,"offlineVideoStreams")));V.push($4(I,C,"transfer"));return g.w2.all(V)}),3);
case 3:if(!b){U.LX(4);break}return g.y(U,reC(P),4);case 4:a6({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:P,DZ:C,offlineModeType:(G=J)==null?void 0:G.offlineModeType}),g.l$(U)}})},ye4=function(p,d,b,v){if(!p.action.entityKey)throw Error("entityKey is missing.");
var P=g.qd(p.action.entityKey);P={entityType:P.jQ,entityId:P.entityId,offlineOrchestrationActionType:p.action.actionType,orchestrationAction:{orchestrationActionId:p.actionId}};d&&(P.offlineOrchestrationActionResult=d.status,P.isRetryable=b?!1:d.D,d.B&&(P.offlineOrchestrationFailureReason=cez(d.B,P.isRetryable)));var M,X;if((M=p.action.actionMetadata)==null?0:(X=M.offlineLoggingData)==null?0:X.offlineModeType)P.offlineModeType=p.action.actionMetadata.offlineLoggingData.offlineModeType;v&&(P.additionalOrchestrationActions=
v.map(function(a){return{orchestrationActionId:a.actionId}}));
return P},cez=function(p,d){return p!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||d?p==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&d?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":p:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},IfX=function(p,d){var b={offlineOrchestrationContext:ye4(p)};
d=xMX(d,b);BS2(KUq(),d,p.rootActionId)},zq6=function(p,d,b,v){v=v===void 0?[]:v;
d={offlineOrchestrationContext:ye4(p,d,b,v)};d=xMX(3,d);BS2(KUq(),d,p.rootActionId)},j_X=function(){this.actions=[]},tH3=function(p,d){d=g.u(d);
for(var b=d.next();!b.done;b=d.next())b=b.value,IfX(b,1),p.actions.push(b);p.actions.sort(p.D)},iPC=function(p,d){if(d)for(var b=0;b<p.actions.length;b++)if(d==="!*$_ALL_ENTITIES_!*$"&&p.actions[b].actionId!==d||d!=="!*$_ALL_ENTITIES_!*$"&&p.actions[b].rootActionId===d&&p.actions[b].actionId!==d)p.actions.splice(b,1),b--},HPz=function(p,d){p=g.u(p.actions);
for(var b=p.next();!b.done;b=p.next())if(b.value.actionId===d)return!0;return!1},eM=function(p,d,b,v,P){g.e.call(this);
var M=this;this.U=p;this.kJ=d;this.eB=b;this.Z=v;this.gE=P;this.D=new j_X;this.S=new g.R$;this.B=new g.bR(function(){M.retry()});
this.W=NaN;this.X=!1;this.Up={jf5:function(){return M.D},
nj:function(){return M.S},
PJt:function(){return M.B},
retry:function(){return M.retry()}};
g.Y(this,this.B);this.C=this.U.observe(this.O5.bind(this))},eq2=function(p,d,b,v,P){var M;
return g.z(function(X){if(X.D==1)return M=new eM(p,d,b,v,P),g.y(X,Dez(M),2);VHW(M);return X.return(M)})},VHW=function(p){var d=p.D.actions[0];
return p.V?((d==null?void 0:d.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.V[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(p.X=!0),Promise.resolve()):SgQ(p)},SgQ=function(p){var d,b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G;
return g.z(function(U){switch(U.D){case 1:if(p.V)throw Error("Already processing an action");if(p.xJ())return U.return();d=p.D.actions.shift();aQC(p.eB,!d);if(d===void 0)return U.return();d.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&d.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&iPC(p.D,d.actionId);b="";d.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&d.rootActionId===d.actionId&&(b=d.actionId);v=[d];p.V=v;if(P=p.kJ[d.entityType]){U.LX(2);break}p.V=
void 0;return g.y(U,SgQ(p),3);case 3:return U.return();case 2:M=g.u(v);for(X=M.next();!X.done;X=M.next())a=X.value,IfX(a,2);g.sW(U,4,5);return g.y(U,bPC(P,v.map(function(I){return I.action})),7);
case 7:F=U.U,h=g.u(v),O=h.next();case 8:if(O.done){U.LX(10);break}J=O.value;k=F.get(J.action);return g.y(U,YgH(p,J,k),9);case 9:O=h.next();U.LX(8);break;case 10:iPC(p.D,b);case 5:g.NC(U);p.V=void 0;g.GC(U,6);break;case 4:return n=g.Cz(U),v8("Orchestration error",n),g.sW(U,12),g.y(U,gIQ(p,v),14);case 14:g.EW(U,5);break;case 12:r=g.Cz(U);v8("Orchestration retry error",r);Z=g.u(v);for(C=Z.next();!C.done;C=Z.next())G=C.value,G.retryScheduleIndex<3&&tH3(p.D,[G]);U.LX(5);break;case 6:return g.y(U,SgQ(p),
0)}})},YgH=function(p,d,b){var v,P,M,X,a,F,h,O,J,k,n,r;
return g.z(function(Z){switch(Z.D){case 1:v=d.retryScheduleIndex+2===3;if(b.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Z.LX(2);break}if(b.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Z.LX(0);break}zq6(d,b,v);if(b.D&&d.retryScheduleIndex+1<3)return g.y(Z,gIQ(p,[d]),0);M=((P=b)==null?0:P.U)?b.U:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";X={entityKey:d.action.entityKey,failureReason:M};a=void 0;g.QJ(p.gE)?a="mainVideoDownloadStateEntity":g.eo(p.gE)&&(a="musicTrackDownloadMetadataEntity");
if(!a||!b.downloadState){Z.LX(7);break}F=g.qd(d.action.entityKey).entityId;return g.y(Z,Jj(F,a,p.U,b.downloadState),7);case 7:MY(p.Z,X);if(b.downloadState==="DOWNLOAD_STATE_FAILED"&&p.gE.T("html5_auto_retry_failed_pde_actions")){Z.LX(0);break}v8("Orchestration result is not retryable, deleting action");return g.y(Z,UM6(p.U,lP(d).key),0);case 2:h=void 0;try{h=(O=b.V)==null?void 0:O.map(function(C){return p.createAction(C,d)})}catch(C){return zq6(d,b,v),J={entityKey:d.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},MY(p.Z,J),v8("Orchestration subactions creation error",C),Z.return()}zq6(d,b,v,h);if(!h){Z.LX(12);break}k=h.map(function(C){return lP(C)});
n=0;case 13:if(!(n<h.length)||p.X){Z.LX(15);break}return g.y(Z,BN(p.U,{mode:"readwrite",Ib:!0},function(C){var G=[];G.push(fj3(C,k.slice(n,n+10),"offlineOrchestrationActionWrapperEntity"));return g.w2.all(G)}),16);
case 16:n+=10;Z.LX(13);break;case 15:if(p.X)return p.X=!1,Z.return();case 12:return r=lP(d),g.y(Z,UM6(p.U,r.key),17);case 17:IfX(d,4),g.l$(Z)}})},meX=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n;
return g.z(function(r){b=[];v=Infinity;P=4E3;M=g.u(d);for(X=M.next();!X.done;X=M.next())a=X.value,F=Number(a.enqueueTimeSec),h=LvR(F),O=a.retryScheduleIndex,J=O!=null&&O>0,h>0&&J?(v=Math.min(v,F),P=Math.min(h,P)):b.push(a);isFinite(v)&&(!p.B.isActive()||v<p.W)&&(p.W=v,p.B.start(P));p.S.v$()||(k=b.length,b=b.filter(function(Z){var C;Z=((C=Z.actionProto)==null?void 0:C.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Q_2.includes(Z)}),n=b.length<k,!p.B.isActive()&&n&&p.B.start(1));
b.length>0&&$eX(p,b);return g.y(r,VHW(p),0)})},xeQ=function(p){var d,b,v,P,M,X,a;
return g.z(function(F){if(F.D==1)return g.y(F,KvW(p),2);d=F.U;b=[];v=g.u(d);for(P=v.next();!P.done;P=v.next())M=P.value,X=g.qd(M.key),a=X.entityId,HPz(p.D,a)||b.push(M);return g.y(F,meX(p,b),0)})},LvR=function(p){p=p*1E3-Date.now();
return p>4E3?4E3:p},gIQ=function(p,d){var b,v,P;
return g.z(function(M){b=g.u(d);for(v=b.next();!v.done;v=b.next()){P=v.value;var X=void 0,a=void 0,F=((a=P.action)==null?void 0:(X=a.actionMetadata)==null?void 0:X.retryScheduleIntervalsInSeconds)||[1,2,4];X=1;P.retryScheduleIndex<F.length&&(X=F[P.retryScheduleIndex]);P.D=X*1E3+Date.now();P.retryScheduleIndex++}return g.y(M,BNz(p,d),0)})},Dez=function(p){var d;
return g.z(function(b){if(b.D==1)return g.y(b,AJ(p.U,"offlineOrchestrationActionWrapperEntity"),2);d=b.U;return g.y(b,meX(p,d),0)})},$eX=function(p,d){d.length!==0&&d.forEach(function(b){b=uP(b);
b.retryScheduleIndex<3&&tH3(p.D,[b])})},KvW=function(p,d){var b;
return g.z(function(v){if(v.D==1)return g.y(v,AJ(p.U,"offlineOrchestrationActionWrapperEntity",d),2);b=v.U;return v.return(b.filter(iXC))})},BNz=function(p,d){if(d.length===0)return Promise.resolve([]);
d=d.map(function(b){return lP(b)});
return waC(p.U,d)},RqQ=function(p){this.MC=p;
this.D=void 0},TNq=function(p,d){var b,v,P,M;
return g.z(function(X){b=d.videoId;v=!0;if(d.captionTracks.length)P=nT6(d),p.D=new g.IS(p.MC,d,P);else if(d.Q7)M=g.quq(d),p.D=new g.j4(p.MC,d.Q7,b,M,d.bl,d.eventId),v=d.bl;else return X.return();return X.return(new Promise(function(a){var F;(F=p.D)==null||F.hm({rH:function(){return g.z(function(h){if(h.D==1)return g.y(h,p.rH(b,v),2);a();g.l$(h)})},
Fd:function(){}})}))})},AeF=function(p){var d;
return g.z(function(b){if(b.D==1)return g.y(b,SPR(p),2);d=b.U;return b.return(!!d&&d.length>0)})},SM=function(p){g.e.call(this);
this.D=p;this.U=this.D.observe(this.B.bind(this))},WvQ=function(p,d){var b,v,P,M,X,a,F;
return g.z(function(h){switch(h.D){case 1:if(d.length===0)return h.return([]);b=d.map(function(O){return g.aC(O,"transfer")});
return g.y(h,AJ(p.D,"transfer",b),2);case 2:v=h.U;P=v.filter(iXC).map(function(O){return g.qd(O.key).entityId});
M=d.filter(function(O){return P.indexOf(O)===-1});
if(M.length===0)return h.return([]);X=g.u(M);a=X.next();case 3:if(a.done){h.LX(5);break}F=a.value;return g.y(h,reC(F),4);case 4:a=X.next();h.LX(3);break;case 5:return h.return(M)}})},bSC=function(p,d,b,v,P,M){var X,a,F;
return g.z(function(h){X="STREAM_TYPE_UNKNOWN";b.video&&b.audio?(X="STREAM_TYPE_AUDIO_AND_VIDEO",v8("unexpected stream type")):b.video&&!b.audio?X="STREAM_TYPE_VIDEO":!b.video&&b.audio&&(X="STREAM_TYPE_AUDIO");a=g.aC(d,"offlineVideoStreams");F={numBytesDownloaded:P.toFixed(),numTotalBytes:M.toFixed(),streamType:X,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(v),itag:X==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(b.itag):void 0};return g.y(h,BN(p,{mode:"readwrite",Ib:!0},
function(O){var J=gO(O,a,"offlineVideoStreams"),k=gO(O,g.aC(d,"transfer"),"transfer");return g.w2.all([J,k]).then(function(n){n=g.u(n);var r=n.next().value;n=n.next().value;if(!n)return ma(O,a).then(function(){});
var Z=p44(r);r=dKz(r,v,F,a);var C=$4(O,r,"offlineVideoStreams");p44(r)>Z&&(n.lastProgressTimeMs=Date.now().toString());Z=[C];n.offlineVideoStreams||(n.offlineVideoStreams=[]);n.offlineVideoStreams.indexOf(a)===-1&&(n.offlineVideoStreams.push(a),Z.push($4(O,n,"transfer")));return g.w2.all(Z)})}),0)})},voH=function(p,d){var b,v,P,M,X;
return g.z(function(a){if(a.D==1)return b=g.aC(d,"offlineVideoStreams"),g.y(a,TA(p,b,"offlineVideoStreams"),2);v=a.U;if(!v||!v.streamsProgress)return a.return();P=g.u(v.streamsProgress);for(M=P.next();!M.done;M=P.next())X=M.value,X.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",X.numTotalBytes!==X.numBytesDownloaded&&(X.numBytesDownloaded=X.numTotalBytes);return g.y(a,RX(p,v,"offlineVideoStreams"),0)})},dKz=function(p,d,b,v){if(p&&p.streamsProgress){v=p;
a:{d=d.itag+";"+d.xtags;for(var P=p.streamsProgress,M=0;M<P.length;M++){var X=JSON.parse(P[M].formatStreamBytes);if(X.itag+";"+X.xtags===d){P[M]=b;b=P;break a}}P.push(b);b=P}v.streamsProgress=b}else p={key:v,streamsProgress:[b]};return p},p44=function(p){if(p==null?0:p.streamsProgress){var d=0;
p=p.streamsProgress;for(var b=0;b<p.length;b++){var v=p[b];isNaN(Number(v.numBytesDownloaded))?v8("stream progress bytes number invalid"):d+=Number(v.numBytesDownloaded)}return d}return 0},PNX=function(p,d,b,v){g.e.call(this);
var P=this;this.U=p;this.api=d;this.oB=b;this.O5=v;this.S=new g.R$;this.V=new g.bR(function(){P.D&&P.D.transferState==="TRANSFER_STATE_TRANSFERRING"&&P.S.v$()&&((P.D.transferRetryCount||0)<3?VW(P.Z,P.X,!1,!1):Dy(P.Z,P.X.videoDetails.videoId),P.w8("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.eB=this.RB=0;this.C=this.W=!1;this.TB=g.JH(this.api.G().experiments,"html5_transfer_processing_logs_interval");this.wE=new g.iO(this);this.Up={Eib:function(){return P.V},
o65:function(){return P.O5},
nj:function(){return P.S}};
this.kJ=this.U.observe(this.Dd.bind(this));this.Z=new nIX(d,this);this.YJ=new RqQ(d);this.aB=new SM(this.U);this.Hb=this.S.listen("publicytnetworkstatus-online",this.VA.bind(this));this.IB=this.S.listen("publicytnetworkstatus-offline",this.uNB.bind(this));this.C=this.api.G().T("html5_less_transfer_processing_logs");g.Y(this,this.wE);this.wE.Y(d,"offlinetransferpause",this.waZ);g.QJ(this.api.G())?this.B="mainVideoDownloadStateEntity":g.eo(this.api.G())&&(this.B="musicTrackDownloadMetadataEntity")},
MdH=function(p){return g.z(function(d){if(d.D==1)d=g.y(d,VUC(),2);
else{var b=p.aB;var v=g.EK();v=Object.keys(v);b=WvQ(b,v);d=g.y(d,b,0)}return d})},gE=function(p,d){d=d===void 0?!1:d;
var b;return g.z(function(v){if(v.D==1){if(p.D)throw Error("Already downloading a video");p.eB=0;p.W=!1;return g.y(v,X4m(p),2)}return v.D!=4?(b=v.U,oaF(p.oB,!b),b&&p.S.v$()?d?g.y(v,new Promise(function(P){g.lg(P,1E3)}),4):v.LX(4):(!b&&p.D&&Y2(p),v.LX(0))):g.y(v,q52(p,b),0)})},a_H=function(p){return g.z(function(d){if(d.D==1)return p.X?g.y(d,Dy(p.Z,p.X.videoDetails.videoId),3):d.LX(0);
Y2(p);g.l$(d)})},ooW=function(p,d){var b,v,P;
return g.z(function(M){switch(M.D){case 1:return g.sW(M,2),(b=!!d.captionTracks.length||!!d.Q7)?g.y(M,AeF(d.videoId),4):M.return();case 4:return(v=M.U)?M.return():g.y(M,TNq(p.YJ,d),5);case 5:g.EW(M,0);break;case 2:P=g.Cz(M),v8("Caption downloading error",P,d.cotn),g.l$(M)}})},q52=function(p,d){var b,v,P,M,X,a;
return g.z(function(F){switch(F.D){case 1:if(p.W)return F.return();p.W=!0;p.D=d;b=g.qd(p.D.key);v=b.entityId;P=void 0;if(p.D.transferState==="TRANSFER_STATE_TRANSFERRING")return g.y(F,L7(p,v),7);if(p.D.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||p.D.transferRetryCount||p.D.hasLoggedFirstStarted){F.LX(3);break}return g.y(F,L7(p,v),5);case 5:return P=F.U,p.D.hasLoggedFirstStarted=!0,g.y(F,FrR(p),6);case 6:Fp3({videoId:v,DZ:p.D,offlineModeType:P},void 0,void 0,!0);F.LX(3);break;case 7:P=F.U,
a6({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:v,DZ:p.D,offlineModeType:P});case 3:return g.y(F,h4H(p),8);case 8:return M=null,g.sW(F,9),g.y(F,OS6(p,d),11);case 11:M=F.U;p.X=M;g.EW(F,10);break;case 9:return X=g.Cz(F),v8("error getting player response",X,d.cotn),g.y(F,p.w8("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return F.return();case 10:return a=rqm(p.api.G(),d.cotn,M),g.y(F,ooW(p,a),13);case 13:return g.y(F,ffX(a.videoId),
14);case 14:a.AJ=F.U,ZPH(p.Z,a,d.maximumDownloadQuality),p.V.start(108E5),g.l$(F)}})},X4m=function(p){var d,b;
return g.z(function(v){if(v.D==1)return g.y(v,AJ(p.U,"transfer"),2);d=v.U;b=d.filter(Jr6).sort(kPQ);return b.length===0?v.return():v.return(b[0])})},h4H=function(p){var d,b,v;
return g.z(function(P){if(P.D==1){if(!p.D)return QW(p,"onTransferStart"),P.return();p.V.start(108E5);return g.y(P,$2(p,"TRANSFER_STATE_TRANSFERRING"),2)}d=p.D;return(v=((b=d)==null?0:b.key)?g.qd(d.key).entityId:"")&&p.B?g.y(P,Jj(v,p.B,p.U,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):P.LX(0)})},lfQ=function(p){var d,b,v,P;
g.z(function(M){switch(M.D){case 1:if(!p.D){QW(p,"onTransferPausedByUser");M.LX(2);break}d=p.D;p.V.stop();return g.y(M,$2(p,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:v=((b=d)==null?0:b.key)?g.qd(d.key).entityId:"";if(!v||!p.B){M.LX(4);break}return g.y(M,Jj(v,p.B,p.U,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.y(M,L7(p,v),6);case 6:P=M.U,h6W({videoId:v,DZ:d,offlineModeType:P});case 2:Y2(p),gE(p),g.l$(M)}})},s_Q=function(p){var d,b,v;
g.z(function(P){if(P.D==1){if(!p.D)return QW(p,"onTransferPausedByNetwork"),P.return();p.V.stop();return g.y(P,$2(p,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(P.D!=3)return d=p.D,(v=((b=d)==null?0:b.key)?g.qd(d.key).entityId:"")&&p.B?g.y(P,Jj(v,p.B,p.U,"DOWNLOAD_STATE_PAUSED"),3):P.LX(3);Y2(p);g.l$(P)})},noQ=function(p){var d,b,v,P,M;
g.z(function(X){switch(X.D){case 1:if(!p.D)return QW(p,"onTransferComplete"),X.return();d=p.D;p.V.stop();if(!d||!p.X){X.LX(2);break}b=rqm(p.api.G(),d.cotn,p.X);return g.y(X,ooW(p,b),2);case 2:return g.y(X,$2(p,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:P=((v=d)==null?0:v.key)?g.qd(d.key).entityId:"";if(!P||!p.B){X.LX(5);break}return g.y(X,Jj(P,p.B,p.U,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.y(X,voH(p.U,P),7);case 7:return g.y(X,L7(p,P),8);case 8:M=X.U,a6({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:P,DZ:d,offlineModeType:M}),Y2(p),gE(p),g.l$(X)}})},rrm=function(p,d,b){var v,P;
g.z(function(M){switch(M.D){case 1:if(!p.D)return QW(p,"onTransferProgress: "+d),M.return();if(p.D.transferState==="TRANSFER_STATE_TRANSFERRING"){M.LX(2);break}return g.y(M,h4H(p),2);case 2:v=Date.now();if(!(v-p.RB>1E3)){M.LX(4);break}p.RB=v;return g.y(M,bSC(p.U,b.videoId,b.U,b.Ca,b.bytesDownloaded,b.D),5);case 5:if(p.C&&!(p.C&&v-p.eB>p.TB)){M.LX(4);break}p.eB=v;return g.y(M,L7(p,d),7);case 7:P=M.U,Fp3({videoId:d,DZ:p.D,offlineModeType:P},b.bytesDownloaded,b.D);case 4:p.V.start(108E5),g.l$(M)}})},
f_W=function(p){var d=(p.D.transferRetryCount||0)<3;
d&&(p=p.D,p.transferRetryCount=(p.transferRetryCount||0)+1);return d},u7F=function(p,d){d=d===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":d;
var b,v,P,M;return g.z(function(X){if(X.D==1)return p.D||QW(p,"setTransferToFailed: "+d),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d==="TRANSFER_FAILURE_REASON_NETWORK"?b="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":d==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.y(X,$2(p,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",d),2);if(X.D!=3)return MY(p.O5,{entityKey:(v=p.D)==null?void 0:v.key,failureReason:b}),
P=p.D?g.qd(p.D.key).entityId:"",g.y(X,L7(p,P),3);M=X.U;var a={videoId:P,DZ:p.D,offlineModeType:M},F=d,h={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};F&&(h.transferFailureReason=F,h.failureReason=Oj4(F));a6(h,a);g.l$(X)})},$2=function(p,d,b,v){var P;
return g.z(function(M){if(M.D==1){if(!p.D)return QW(p,"saveTransferState: "+d),M.return();p.D.transferState=d;p.D.failureReason=v;g.sW(M,2);return g.y(M,FrR(p,function(X){return b?L6(X,"offlineVideoStreams",p.D.offlineVideoStreams).then(function(a){for(var F=g.u(a),h=F.next();!h.done;h=F.next())if((h=h.value)&&h.streamsProgress){h=g.u(h.streamsProgress);for(var O=h.next();!O.done;O=h.next())O.value.streamState=b}return fj3(X,a.filter(function(J){return!!J}),"offlineVideoStreams")}):g.w2.resolve(void 0)}),
4)}if(M.D!=2)return g.EW(M,0);
P=g.Cz(M);return P instanceof g.lp&&P.type==="QUOTA_EXCEEDED"?g.y(M,p.w8("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):M.LX(0)})},FrR=function(p,d){var b;
return g.z(function(v){if(!p.D)return v.return();b=p.D;return g.y(v,BN(p.U,{mode:"readwrite",Ib:!0},function(P){var M=[$4(P,b,"transfer")];d&&M.push(d(P));return g.w2.all(M)}),0)})},Y2=function(p){p.D=void 0;
p.X=void 0;p.V.stop()},OS6=function(p,d){var b,v,P,M,X;
return g.z(function(a){if(a.D==1)return b=g.qd(d.key),v=b.entityId,P=g.aC(v,"playbackData"),g.y(a,TA(p.U,P,"playbackData"),2);M=a.U;if((X=M)==null?0:X.playerResponseJson)return a.return(JSON.parse(M.playerResponseJson));throw Error("No PlayerResponse found");})},QW=function(p,d){p.api.E5("woffle",{mcte:d});
v8("missing current transfer entity.")},L7=function(p,d){var b,v,P;
return g.z(function(M){if(M.D==1)return g.y(M,TA(p.U,g.aC(d,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);b=M.U;return M.return((P=(v=b)==null?void 0:v.offlineModeType)!=null?P:void 0)})},Jr6=function(p){return l_m[p.transferState]!==void 0},kPQ=function(p,d){var b=l_m[p.transferState],v=l_m[d.transferState];
return b!==v?b-v:Number(p.enqueuedTimestampMs)-Number(d.enqueuedTimestampMs)},mh=function(p,d){var b=this;
this.gE=p;this.api=d;this.S=new g.R$;this.X=new g.fC;this.Up={qR:function(){return b.B.Up.qR()},
nj:function(){return b.S},
TO5:function(){return b.B},
Qs:function(){return b.Qs()},
h3:function(){return b.h3()},
F8:function(){return b.F8()},
kc:function(){return b.kc()},
De:function(){return b.De()},
KD:function(v){return b.KD(v)}};
this.B=new Miz(function(){return smW(b)},function(){b.F8()},this.api.dc(),this.api.T.bind(this.api));
this.D=new P8(this.api);XGX(this.B)},smW=function(p){return g.z(function(d){p.api.KX("onOrchestrationBecameLeader");
return g.y(d,p.h3(),0)})},Eoz=function(p){var d,b;
return g.z(function(v){if(v.D==1)return g.y(v,WN(),2);if(v.D!=3){d=v.U;if(!d)return v8("PES is undefined"),v.return();p.U=new PNX(d,p.api,p.B,p.D);b=p.jf(d);return g.y(v,eq2(d,b,p.B,p.D,p.gE),3)}p.Z=v.U;return g.y(v,ZSz(p),0)})},ZSz=function(p){var d;
return g.z(function(b){switch(b.D){case 1:if(!p.U)return v8("transferManager is undefined"),b.return();if(p.U.D){b.LX(2);break}return g.y(b,gE(p.U),2);case 2:if(!p.gE.T("woffle_enable_main_downloads_library")){b.LX(4);break}return g.y(b,p.E9(),4);case 4:if(!p.gE.T("html5_offline_playback_position_sync")){b.LX(6);break}return g.y(b,p.au(),7);case 7:return g.y(b,p.KD(864E5),6);case 6:return g.y(b,p.refreshAllStaleEntities(43200,!0),9);case 9:return g.y(b,p.PO(),10);case 10:if(!p.gE.T("html5_retry_downloads_for_expiration")){b.LX(11);
break}return g.y(b,p.De(),11);case 11:return p.W=g.sI(function(){p.refreshAllStaleEntities(43200,!0);p.PO()},9E5),g.d2(g.vQ(),function(){return p.kc()}),g.y(b,WN(),13);
case 13:return d=b.U,g.y(b,PhH(d),14);case 14:q1X(p.B),g.l$(b)}})},CNW=function(){var p,d,b,v,P,M;
return g.z(function(X){switch(X.D){case 1:return g.y(X,WN(),2);case 2:p=X.U;if(!p)return X.return([]);d=Date.now()/1E3;return g.y(X,AJ(p,"offlineVideoPolicy"),3);case 3:b=X.U,v=g.u(b),P=v.next();case 4:if(P.done){X.LX(6);break}M=P.value;if(!(M.expirationTimestamp&&Number(M.expirationTimestamp)<d)){X.LX(5);break}M.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";M.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.y(X,RX(p,M,"offlineVideoPolicy"),5);
case 5:P=v.next();X.LX(4);break;case 6:return X.return(b.map(function(a){return a.key}))}})},K7=function(p,d,b,v,P){var M,X,a;
return g.z(function(F){if(F.D==1)return g.y(F,WN(),2);M=F.U;if(!M)return F.return([]);X=d.map(function(h){var O=g.aC(h,b);O={actionType:v,entityKey:O,actionMetadata:Object.assign({},fQ3(),P)};v!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(O.actionMetadata.priority=0);h=new f7(b,h,O);return lP(h)});
a=waC(M,X);XGX(p.B);return F.return(a)})},NcR=function(p,d,b,v){var P,M,X,a,F,h,O,J;
return g.z(function(k){switch(k.D){case 1:P=[],M=g.u(d),X=M.next();case 2:if(X.done){k.LX(4);break}a=X.value;if(a.upToDate||b&&!a.shouldAutoSyncMetadata||!a.playlistId){k.LX(3);break}F={};switch(v){case "mainPlaylistEntity":h={nextAutoRefreshIntervalSeconds:a.checkInSeconds,autoSync:b};F={mainPlaylistEntityActionMetadata:h};break;case "musicPlaylist":O={autoSync:b},F={musicPlaylistEntityActionMetadata:O}}return g.y(k,K7(p,[a.playlistId],v,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",F),6);case 6:(J=
k.U)&&P.push.apply(P,g.E(J));case 3:X=M.next();k.LX(2);break;case 4:return k.return(P)}})},GPR=function(p,d){var b;
return g.z(function(v){return d.length?(b=fQ3(),g.gK(b,iP,{isEnqueuedForExpiredStreamUrlRefetch:!0}),p.api.E5("qrd",{v:d.length}),v.return(K7(p,d,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b))):v.return([])})},w4Q=function(p,d,b){this.D=p;
this.gE=d;this.B=b},yr3=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U;
return g.z(function(I){switch(I.D){case 1:return b=o6(d),v=g.qd(d.entityKey),P=v.entityId,M=[],g.sW(I,2),g.y(I,UKW(p,P),4);case 4:M=I.U;if(!(p.gE.T("woffle_enable_main_downloads_library")&&((X=M)==null?0:X.length))){I.LX(5);break}return g.y(I,IQ2(p.D,[d.entityKey]),5);case 5:g.EW(I,3);break;case 2:return a=g.Cz(I),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.lp&&a.type==="QUOTA_EXCEEDED"?(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):v8("Playlist add error"),I.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,F,h));case 3:O=[];if(!p.gE.T("html5_offline_prevent_redownload_downloaded_video")){I.LX(7);break}return g.y(I,naH(p.D,"mainVideoEntity",M),8);case 8:M=I.U;case 7:if((J=M)==null?0:J.length)for(k=g.u(M),n=k.next();!n.done;n=k.next())if(r=n.value,Z=r.offlineVideoData,C=void 0,(C=Z)==null?0:C.videoId)G=void 0,U=Number(((G=d.actionMetadata)==null?void 0:G.priority)||
0)+1,O.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"mainVideoEntity",U,x2,cr3(d,Z,P)));return I.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,O))}})},z46=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC,vm,rQ,N,w,c,t,D,b$,MC,Xu,H,h7,rw,oK,zC,J4,SX,OF,$u,VT,aj,zj,KH,kE,QB,e5,$i,ZG,nH,t$,Jm,iY,D6,Vb,zl,TN,mf,vS,U5,L0;
return g.z(function(JP){switch(JP.D){case 1:return b=o6(d),v=d.entityKey,P=g.qd(v).entityId,M=[],X=!1,P==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.y(JP,AJ(p.D,"mainPlaylistEntity"),5)):g.y(JP,TA(p.D,v,"mainPlaylistEntity"),4);case 4:(a=JP.U)&&M.push(a);JP.LX(3);break;case 5:M=JP.U;case 3:if((F=M)==null||!F.length)return JP.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));h=g.L(d.actionMetadata,I_6);J=(O=h)==null?void 0:O.nextAutoRefreshIntervalSeconds;n=(k=h)==null?void 0:k.autoSync;r=[];C=Z=
!0;G=!1;if(!X&&n===!1){JP.LX(6);break}g.sW(JP,7);return g.y(JP,$VR(0,!!n,!0,M),9);case 9:r=JP.U;g.EW(JP,8);break;case 7:U=g.Cz(JP);if(!(U instanceof Error&&U.message==="No data")){U instanceof Error&&U.message==="Empty response body"&&v8(U.message);JP.LX(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.y(JP,Ng6(p.D,d,p.B,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.y(JP,EaF(P,p.D,d,p.B),8);case 8:if(!r.length||!X&&r[0].playlistId!==P)return JP.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b));case 6:if(X){I=[];V=g.u(r);for(S=V.next();!S.done;S=V.next())B=S.value,B.upToDate||n&&!B.shouldAutoSyncMetadata||!B.playlistId||(x={nextAutoRefreshIntervalSeconds:B.checkInSeconds,autoSync:n},I.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B.playlistId,"mainPlaylistEntity",0,x2,{mainPlaylistEntityActionMetadata:x})));return JP.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,I))}r.length&&(Pj=r[0],G=!!Pj.upToDate,n&&(Z=(qC=Pj.shouldAutoSyncMetadata)!=null?qC:!0,C=(pz=Pj.shouldAutoSyncVideos)!=
null?pz:!0,Pj.checkInSeconds&&(J=Pj.checkInSeconds)));if(G||!Z)return JP.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));Q=[];W=M[0];if(!W.downloadState){l=void 0;JP.LX(15);break}return g.y(JP,TA(p.D,W.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:l=JP.U;case 15:return m=l,Z2=((Yu=m)==null?0:Yu.addedTimestampMillis)?String(m.addedTimestampMillis):void 0,g.sW(JP,17),g.y(JP,UKW(p,P,Z2,J),19);case 19:Q=JP.U;g.EW(JP,18);break;case 17:O6=g.Cz(JP);if(!(O6 instanceof Error&&
O6.message==="No data for playlist")){if(O6 instanceof Error&&O6.message==="Empty response body for playlist")v8(O6.message);else return UW="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",TC="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O6 instanceof g.lp&&O6.type==="QUOTA_EXCEEDED"&&(UW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",TC="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),JP.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,UW,TC));JP.LX(18);
break}return g.y(JP,EaF(P,p.D,d,p.B),18);case 18:if(!C)return JP.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));vm=[];rQ=new Map;if((N=Q)==null?0:N.length)for(w=g.u(Q),c=w.next();!c.done;c=w.next())t=c.value,D=t.offlineVideoData,b$=void 0,((b$=D)==null?0:b$.videoId)&&rQ.set(D.videoId,D);MC=new Map;Xu=[];if((H=W)==null?0:(h7=H.videos)==null?0:h7.length)for(rw=g.u(W.videos),oK=rw.next();!oK.done;oK=rw.next())if(zC=oK.value,J4=JSON.parse(g.qd(zC).entityId),SX=J4.videoId)rQ.has(SX)?(MC.set(SX,
rQ.get(SX)),rQ.delete(SX)):Xu.push(SX);$u=Number(((OF=d.actionMetadata)==null?void 0:OF.priority)||0)+1;VT=g.u(rQ.entries());for(aj=VT.next();!aj.done;aj=VT.next())zj=aj.value,KH=g.u(zj),kE=KH.next().value,QB=KH.next().value,e5=kE,$i=QB,vm.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e5,"mainVideoEntity",$u,x2,cr3(d,$i,P)));ZG=g.u(MC.entries());for(nH=ZG.next();!nH.done;nH=ZG.next())t$=nH.value,Jm=g.u(t$),iY=Jm.next().value,D6=Jm.next().value,Vb=iY,zl=D6,vm.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Vb,"mainVideoEntity",$u,x2,cr3(d,zl,P)));TN=g.u(Xu);for(mf=TN.next();!mf.done;mf=TN.next())vS=mf.value,U5={playlistId:P},L0={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:U5},vm.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",vS,"mainVideoEntity",0,x2,L0));return JP.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,vm))}})},jm3=function(p,d){var b,v,P,M;
return g.z(function(X){switch(X.D){case 1:return b=o6(d),g.sW(X,2),v=g.qd(d.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.y(X,Ng6(p.D,d,p.B,(P=d.actionMetadata)==null?void 0:(M=P.offlineLoggingData)==null?void 0:M.offlineDeleteReason),5):g.y(X,EaF(v,p.D,d,p.B),6);case 6:if(!p.gE.T("woffle_enable_main_downloads_library")){X.LX(5);break}return g.y(X,z66(p.D,d.entityKey),5);case 5:g.EW(X,3);break;case 2:return g.Cz(X),X.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b))}})},UKW=function(p,d,b,v){var P,M,X,a,F,h,O;
return g.z(function(J){switch(J.D){case 1:return g.y(J,LpH([d]),2);case 2:return P=J.U,g.y(J,tdH(p,P[0],b,v),3);case 3:return M=J.U,X=M.mainPlaylistEntity,a=M.Td$,h=syQ(X,(F=a)==null?void 0:F.avatar),g.sW(J,4),g.y(J,Zy(h),6);case 6:g.EW(J,5);break;case 4:O=g.Cz(J),O instanceof Error&&O.message==="Failed to fetch"&&v8(O.message);case 5:return J.return(P[0].videos)}})},tdH=function(p,d,b,v){var P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V;
return g.z(function(S){switch(S.D){case 1:P=Date.now().toString();b||(b=P);M=d.videos;X=d.playlistId;a=[];F=[];if(M)for(h=g.u(M),O=h.next();!O.done;O=h.next()){J=O.value;k=J.offlineVideoData;if(!k||!k.videoId)throw v8("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");n=k.videoId;r={videoId:n,playlistId:X};Z={id:g.aC(JSON.stringify(r),"mainPlaylistVideoEntity"),video:g.aC(n,"mainVideoEntity")};a.push(Z);F.push(Z.id)}G={key:g.aC(X,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:b,lastSyncedTimestampMillis:P};U={key:g.aC(X,"mainPlaylistEntity"),playlistId:X,videos:F,title:d.title,thumbnailStyleData:iS4(d),visibility:HSq(d),downloadState:G.key};d.channel&&(I=d.channel.offlineChannelData,C=DKH(g.aC(X,"ytMainChannelEntity"),I),U.channelOwner=C.id);((V=U)==null?0:V.entityMetadata)?(U.entityMetadata.offlineLastModifiedTimestampSeconds=d.lastModifiedTimestamp,v&&(U.entityMetadata.nextAutoRefreshIntervalSeconds=String(v))):U&&(U.entityMetadata={nextAutoRefreshIntervalSeconds:v?
String(v):void 0,offlineLastModifiedTimestampSeconds:d.lastModifiedTimestamp});g.sW(S,2);return g.y(S,BN(p.D,{mode:"readwrite",Ib:!0},function(B){var x=$4(B,U,"mainPlaylistEntity"),Pj=$4(B,G,"mainPlaylistDownloadStateEntity");x=[x,Pj];Pj=g.u(a);for(var qC=Pj.next();!qC.done;qC=Pj.next())x.push($4(B,qC.value,"mainPlaylistVideoEntity"));C&&x.push($4(B,C,"ytMainChannelEntity"));return g.w2.all(x)}),4);
case 4:g.EW(S,3);break;case 2:throw g.Cz(S),v8("PES failure for playlist"),Error("PES failure for playlist");case 3:return S.return({mainPlaylistEntity:U,Td$:C,PNB:a})}})},DKH=function(p,d){return{id:p,
channelId:d.channelId,title:d.title,avatar:d.thumbnail}},iS4=function(p){var d=[],b=p.videos;
b&&b.length>0&&d.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:b[0].offlineVideoData.thumbnail}}});if((p=p.additionalMetadadatas)&&p.length>0)for(p=g.u(p),b=p.next();!b.done;b=p.next()){var v=b.value.offlineBundleItemPlaylistData,P=void 0;b=(P=v)==null?void 0:P.style;P=void 0;v={collageThumbnail:{coverThumbnail:(P=v)==null?void 0:P.coverThumbnail}};switch(b){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":d.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:v});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":d.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:v});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":d.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:v});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":d.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:v})}}return d},HSq=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},cr3=function(p,d,b){d={offlineVideoData:d,
playlistId:b};if(p=g.L(p.actionMetadata,I_6))d.maximumDownloadQuality=p.maximumDownloadQuality;return{mainVideoEntityActionMetadata:d}},VdF=function(p,d,b){this.D=p;
this.gE=d;this.B=b},Y5m=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r;
return g.z(function(Z){switch(Z.D){case 1:return b=o6(d),v=g.qd(d.entityKey),P=v.entityId,M=g.L(d.actionMetadata,B8),a=!((X=M)==null?0:X.playlistId),g.sW(Z,2),g.y(Z,e46(p,P,void 0,(F=M)==null?void 0:F.offlineVideoData,a),4);case 4:g.EW(Z,3);break;case 2:return h=g.Cz(Z),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.lp&&h.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Z.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,O,J));case 3:k=1;k=Number(((n=d.actionMetadata)==null?void 0:n.priority)||0)+1;var C=(C=g.L(d.actionMetadata,B8))?{playbackDataActionMetadata:{maximumDownloadQuality:C.maximumDownloadQuality}}:void 0;r=jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",k,S5Q,C);return Z.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,[r]))}})},go3=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U;
return g.z(function(I){switch(I.D){case 1:return b=o6(d),v=g.qd(d.entityKey),P=v.entityId,g.y(I,TA(p.D,d.entityKey,"mainVideoEntity"),2);case 2:M=I.U;if(!M){X=void 0;I.LX(3);break}return g.y(I,TA(p.D,M.downloadState,"mainVideoDownloadStateEntity"),4);case 4:X=I.U;case 3:a=X;if(!M||!a)return I.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));g.sW(I,5);return g.y(I,e46(p,P,a.addedTimestampMillis,(h=g.L(d.actionMetadata,B8))==null?void 0:h.offlineVideoData),7);case 7:O=1;O=Number(((J=
d.actionMetadata)==null?void 0:J.priority)||0)+1;F=jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",O,S5Q);g.EW(I,6);break;case 5:k=g.Cz(I);if(!(k instanceof Error&&k.message==="No data")){if(k instanceof Error&&k.message==="Empty response body")v8(k.message);else return n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.lp&&k.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,n,r));I.LX(6);break}return g.y(I,NY(p.D,P),9);case 9:Z=I.U;C=g.L(d.actionMetadata,B8);if(U=(G=C)==null?void 0:G.playlistId)Z.playlistId=U;Z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.y(I,E0(P,p.D,d,p.B,Z),6);case 6:return I.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,F?[F]:void 0))}})},Lr2=function(p,d){var b,v,P,M,X,a,F,h,O,J;
return g.z(function(k){switch(k.D){case 1:return b=o6(d),g.sW(k,2),v=g.qd(d.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.y(k,Ng6(p.D,d,p.B,(O=d.actionMetadata)==null?void 0:(J=O.offlineLoggingData)==null?void 0:J.offlineDeleteReason),5):g.y(k,NY(p.D,v),6);case 6:P=k.U;M=g.L(d.actionMetadata,B8);if(a=(X=M)==null?void 0:X.playlistId)P.playlistId=a;P.offlineDeleteReason=(F=d.actionMetadata)==null?void 0:(h=F.offlineLoggingData)==null?void 0:h.offlineDeleteReason;return g.y(k,E0(v,p.D,d,p.B,P),7);
case 7:if(!p.gE.T("woffle_enable_main_downloads_library")){k.LX(5);break}return g.y(k,z66(p.D,d.entityKey),5);case 5:g.EW(k,3);break;case 2:return g.Cz(k),k.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b))}})},e46=function(p,d,b,v,P){var M,X,a,F,h,O;
return g.z(function(J){switch(J.D){case 1:if(M=v){J.LX(2);break}return g.y(J,gaQ([d]),3);case 3:X=J.U,M=X[0];case 2:return g.y(J,QmR(p,M,b,P),4);case 4:a=J.U;F=a.mainVideoEntity;h=a.channelEntity;g.sW(J,5);var k=rE(F.thumbnail),n=rE(h.avatar);return g.y(J,Zy(k.concat(n)),7);case 7:g.EW(J,0);break;case 5:O=g.Cz(J),O instanceof Error&&O.message==="Failed to fetch"&&v8(O.message),g.l$(J)}})},QmR=function(p,d,b,v){var P,M,X,a,F,h,O,J,k,n,r,Z,C;
return g.z(function(G){switch(G.D){case 1:b||(b=Date.now().toString());M=(P=d.channel)==null?void 0:P.offlineChannelData;X={id:g.aC(d.videoId,"ytMainChannelEntity"),channelId:M.channelId,title:M.title,avatar:M.thumbnail};a={key:g.aC(d.videoId,"mainVideoDownloadStateEntity"),playbackData:g.aC(d.videoId,"playbackData"),addedTimestampMillis:b,videoDownloadContextEntity:g.aC(d.videoId,"videoDownloadContextEntity")};F={key:g.aC(d.videoId,"videoPlaybackPositionEntity"),videoId:d.videoId,lastPlaybackPositionSeconds:"0"};
p.gE.T("html5_offline_playback_position_sync")&&(h={playbackPosition:F.key});O=g.aC(d.videoId,"mainVideoEntity");J={key:O,videoId:d.videoId,title:d.title,thumbnail:d.thumbnail,localizedStrings:{viewCount:d.shortViewCountText},userState:h,lengthSeconds:d.lengthSeconds?Number(d.lengthSeconds):void 0,publishedTimestampMillis:d.publishedTimestamp?(Number(d.publishedTimestamp)*1E3).toString():void 0,formattedDescription:d.description,owner:X.id,downloadState:a.key};if(!p.gE.T("woffle_enable_main_downloads_library")||
!v){G.LX(2);break}return g.y(G,yq2(p.D,[O]),3);case 3:if(r=G.U)k=r.mainDownloadsLibraryEntity,n=r.mainDownloadsListEntity;case 2:return C=kc3,Z={key:g.aC(d.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.gK(a,C,Z),g.y(G,BN(p.D,{mode:"readwrite",Ib:!0},function(U){var I=$4(U,X,"ytMainChannelEntity"),V=$4(U,a,"mainVideoDownloadStateEntity"),S=$4(U,J,"mainVideoEntity");I=[I,V,S];p.gE.T("html5_offline_playback_position_sync")&&(V=$4(U,F,"videoPlaybackPositionEntity"),
I.push(V));k&&(V=$4(U,k,"mainDownloadsLibraryEntity"),I.push(V));n&&(V=$4(U,n,"mainDownloadsListEntity"),I.push(V));Z&&(U=$4(U,Z,"downloadStatusEntity"),I.push(U));return g.w2.all(I)}),4);
case 4:return G.return({mainVideoEntity:J,channelEntity:X})}})},$KQ=function(p,d,b){this.D=p;
this.gE=d;this.B=b},Krz=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W;
return g.z(function(l){switch(l.D){case 1:return b=o6(d),v=[],g.y(l,e1.getInstance(),2);case 2:P=l.U;if(!P){l.LX(3);break}return g.y(l,P.get("sdois"),4);case 4:return M=l.U,g.y(l,(a=P)==null?void 0:a.get("lmqf"),5);case 5:X=l.U;case 3:g.sW(l,6);if(M===void 0)throw Error("prefStorage or opt-in state is undefined");F=[];if(M){l.LX(8);break}return g.y(l,cqW(p.D),9);case 9:F=l.U,F.reverse();case 8:if(!F.length){l.LX(10);break}h=g.u(F);O=h.next();case 11:if(O.done){l.LX(10);break}J=O.value;if(!J){l.LX(12);
break}k=g.qd(J).entityId;return g.y(l,NY(p.D,k),14);case 14:return n=l.U,n.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.y(l,E0(k,p.D,{entityKey:J,actionType:d.actionType},p.B,n),12);case 12:O=h.next();l.LX(11);break;case 10:return g.y(l,Kp4(M,(r=X)!=null?r:"SD"),16);case 16:return Z=l.U,g.y(l,Gcq(Z),17);case 17:C=UVq(Z);if(!p.gE.T("woffle_enable_main_downloads_library")){l.LX(18);break}if(M){l.LX(19);break}return g.y(l,z66(p.D,g.i1),19);case 19:return g.y(l,IQ2(p.D,[g.i1]),18);
case 18:if((G=C)==null?0:G.length)for(U=g.u(C),I=U.next();!I.done;I=U.next())if(S=V=I.value,B=S.actionType,x=S.entityKey,Pj=S.actionMetadata,B&&x&&Pj&&!g.L(Pj,mKR)){B==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Pj.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(qC=g.L(V.actionMetadata,B8))qC.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",V.actionMetadata=Object.assign({},V.actionMetadata,{mainVideoEntityActionMetadata:qC});v.push(V)}g.EW(l,7);break;
case 6:return pz=g.Cz(l),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",pz instanceof g.lp&&pz.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,Q,W));case 7:return l.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,v))}})},xK2=function(){mh.apply(this,arguments);
this.C="mainVideoEntity"},Bc2=function(p,d,b){d=d===void 0?43200:d;
b=b===void 0?!0:b;var v=v===void 0?!1:v;var P,M,X;return g.z(function(a){switch(a.D){case 1:if(!p.S.v$())return a.return([]);P=[];g.sW(a,2);return g.y(a,$VR(d,b,v),4);case 4:P=a.U;g.EW(a,3);break;case 2:M=g.Cz(a),M instanceof Error&&M.message==="No data"||M instanceof Error&&M.message==="Empty response body"&&v8(M.message);case 3:return X=NcR(p,P,b,"mainPlaylistEntity"),a.return(X)}})},R4z=function(p,d,b,v){v=v===void 0?!1:v;
var P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U;return g.z(function(I){switch(I.D){case 1:return P=[],g.y(I,mVC(),2);case 2:return(M=I.U)||v?g.y(I,xV4(d,b),3):I.return([]);case 3:X=I.U;if((a=X)==null||!a.length)return I.return([]);F={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};h=g.u(X);O=h.next();case 4:if(O.done){I.LX(6);break}k=J=O.value;n=k.actionType;r=k.entityKey;Z=k.actionMetadata;if(!(n&&r&&Z)||g.L(Z,mKR)){I.LX(5);break}n==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Z.offlineLoggingData=
F);C=g.qd(r);G=C.entityId;return g.y(I,K7(p,[G],"mainVideoEntity",n,Z),8);case 8:U=I.U,P=P.concat(U);case 5:O=h.next();I.LX(4);break;case 6:return I.return(P)}})},Tc4=function(p,d){this.D=p;
this.B=d},Wr3=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G;
return g.z(function(U){switch(U.D){case 1:return b=o6(d),v=g.qd(d.entityKey),P=v.entityId,M=[],g.sW(U,2),g.y(U,Arz(p,P),4);case 4:M=U.U;if((X=M)==null||!X.length){U.LX(5);break}return g.y(U,DVz(p.D,d.entityKey),5);case 5:g.EW(U,3);break;case 2:return a=g.Cz(U),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.lp&&a.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
U.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,F,h));case 3:return O=[],g.y(U,naH(p.D,"musicTrack",M),7);case 7:M=U.U;if(M.length)for(J=g.u(M),k=J.next();!k.done;k=J.next())if(n=k.value,r=n.offlineVideoData,Z=void 0,(Z=r)==null?0:Z.videoId)C=void 0,G=Number(((C=d.actionMetadata)==null?void 0:C.priority)||0)+1,O.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r.videoId,"musicTrack",G,R6,c8(d,r,P)));return U.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,O))}})},
pgq=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC,vm,rQ,N,w,c,t,D,b$,MC,Xu,H,h7,rw,oK,zC,J4,SX,OF,$u,VT,aj,zj,KH,kE,QB;
return g.z(function(e5){switch(e5.D){case 1:return b=o6(d),v=d.entityKey,P=g.qd(v).entityId,M=[],X=!1,P==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.y(e5,AJ(p.D,"musicAlbumRelease"),5)):g.y(e5,TA(p.D,v,"musicAlbumRelease"),4);case 4:(a=e5.U)&&M.push(a);e5.LX(3);break;case 5:M=e5.U;case 3:if((F=M)==null||!F.length)return e5.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));if(X){h=[];O=g.u(M);for(J=O.next();!J.done;J=O.next())k=J.value,n=g.qd(k.id).entityId,h.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
n,"musicAlbumRelease",0,R6));return e5.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,h))}r=[];Z=M[0];C=void 0;if(!Z.downloadMetadata){e5.LX(6);break}return g.y(e5,TA(p.D,Z.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:G=e5.U,C=Number((I=(U=G)==null?void 0:U.addedTimestampMillis)!=null?I:"0")/1E3;case 6:return g.sW(e5,8),g.y(e5,Arz(p,P,(V=C)==null?void 0:V.toString()),10);case 10:r=e5.U;g.EW(e5,9);break;case 8:S=g.Cz(e5);if(!(S instanceof Error&&S.message===
"No data")){if(S instanceof Error&&S.message==="Empty response body")v8(S.message);else return B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.lp&&S.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e5.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,B,x));e5.LX(9);break}return g.y(e5,wE(P,"musicAlbumRelease",p.D,
d,p.B),9);case 9:Pj=[];qC=new Map;if((pz=r)==null?0:pz.length)for(Q=g.u(r),W=Q.next();!W.done;W=Q.next())l=W.value,m=l.offlineVideoData,Yu=void 0,((Yu=m)==null?0:Yu.videoId)&&qC.set(m.videoId,m);Z2=new Map;O6=[];if((UW=Z)==null?0:(TC=UW.tracks)==null?0:TC.length)for(vm=g.u(Z.tracks),rQ=vm.next();!rQ.done;rQ=vm.next())if(N=rQ.value,w=g.qd(N).entityId)qC.has(w)?(Z2.set(w,qC.get(w)),qC.delete(w)):O6.push(w);t=Number(((c=d.actionMetadata)==null?void 0:c.priority)||0)+1;D=g.u(qC.entries());for(b$=D.next();!b$.done;b$=
D.next())MC=b$.value,Xu=g.u(MC),H=Xu.next().value,h7=Xu.next().value,rw=H,oK=h7,Pj.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",rw,"musicTrack",t,R6,c8(d,oK)));zC=g.u(Z2.entries());for(J4=zC.next();!J4.done;J4=zC.next())SX=J4.value,OF=g.u(SX),$u=OF.next().value,VT=OF.next().value,aj=$u,zj=VT,Pj.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",aj,"musicTrack",t,R6,c8(d,zj)));KH=g.u(O6);for(kE=KH.next();!kE.done;kE=KH.next())QB=kE.value,Pj.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",QB,
"musicTrack",0,R6));return e5.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,Pj))}})},dt2=function(p,d){var b,v;
return g.z(function(P){switch(P.D){case 1:return b=o6(d),g.sW(P,2),v=g.qd(d.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.y(P,U0(p.D,d,p.B),5):g.y(P,wE(v,"musicAlbumRelease",p.D,d,p.B),6);case 6:return g.y(P,Viz(p.D,d.entityKey),5);case 5:g.EW(P,3);break;case 2:return g.Cz(P),P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b))}})},Arz=function(p,d,b){var v,P,M;
return g.z(function(X){switch(X.D){case 1:return g.y(X,LpH([d]),2);case 2:return v=X.U,g.y(X,bIX(p,v[0],b),3);case 3:return P=X.U,M=rE(P.thumbnailDetails),g.y(X,Zy(M),4);case 4:return X.return(v[0].videos)}})},bIX=function(p,d,b){var v,P,M,X,a,F,h,O,J,k,n,r,Z,C;
return g.z(function(G){if(G.D==1){v=d.additionalMetadadatas;P=void 0;if(v&&v.length>0)for(M=g.u(v),X=M.next();!X.done;X=M.next())if(a=X.value,a.offlineMusicPlaylistData){P=a.offlineMusicPlaylistData;break}F=d.playlistId;h=e6z(d);O=h.UK;J=h.Df;k=b?(Number(b)*1E3).toString():Date.now().toString();n=d.lastModifiedTimestamp?(Number(d.lastModifiedTimestamp)*1E3).toString():"0";r={id:g.aC(F,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:J,lastModifiedTimestampMillis:n,addedTimestampMillis:k,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Z={id:g.aC(F,"musicAlbumRelease"),title:d.title,audioPlaylistId:F,trackCount:d.totalVideoCount,tracks:O,downloadMetadata:r.id};P&&(Z.thumbnailDetails=(C=P.albumHqThumbnail)!=null?C:P.albumArtistThumbnail,Z.artistDisplayName=P.albumArtistDisplayName,Z.releaseDate=P.albumReleaseDate,Z.contentRating={explicitType:P.albumReleaseExplicitType},Z.releaseType=P.albumReleaseType);return g.y(G,BN(p.D,{mode:"readwrite",Ib:!0},function(U){var I=$4(U,Z,"musicAlbumRelease");
U=$4(U,r,"musicAlbumReleaseDownloadMetadataEntity");return g.w2.all([I,U])}),2)}return G.return(Z)})},vVQ=function(p,d){this.D=p;
this.B=d},MNz=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G;
return g.z(function(U){switch(U.D){case 1:return b=o6(d),v=g.qd(d.entityKey),P=v.entityId,M=[],g.sW(U,2),g.y(U,PRz(p,P),4);case 4:M=U.U;if((X=M)==null||!X.length){U.LX(5);break}return g.y(U,DVz(p.D,d.entityKey),5);case 5:g.EW(U,3);break;case 2:return a=g.Cz(U),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.lp&&a.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
U.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,F,h));case 3:return O=[],g.y(U,naH(p.D,"musicTrack",M),7);case 7:M=U.U;if(M.length)for(J=g.u(M),k=J.next();!k.done;k=J.next())if(n=k.value,r=n.offlineVideoData,Z=void 0,(Z=r)==null?0:Z.videoId)C=void 0,G=Number(((C=d.actionMetadata)==null?void 0:C.priority)||0)+1,O.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r.videoId,"musicTrack",G,T6,c8(d,r,P)));return U.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,O))}})},
Xg3=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC,vm,rQ,N,w,c,t,D,b$,MC,Xu,H,h7,rw,oK,zC,J4,SX,OF,$u,VT,aj,zj,KH,kE,QB,e5,$i,ZG,nH,t$,Jm,iY,D6,Vb,zl,TN,mf;
return g.z(function(vS){switch(vS.D){case 1:return b=o6(d),v=d.entityKey,P=g.qd(v).entityId,M=[],X=!1,P==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.y(vS,AJ(p.D,"musicPlaylist"),5)):g.y(vS,TA(p.D,v,"musicPlaylist"),4);case 4:(a=vS.U)&&M.push(a);vS.LX(3);break;case 5:M=vS.U;case 3:if((F=M)==null||!F.length)return vS.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));h=g.L(d.actionMetadata,S1R);J=(O=h)==null?void 0:O.autoSync;k=[];r=n=!0;Z=!1;C=void 0;if(!X&&J===!1){vS.LX(6);break}g.sW(vS,7);return g.y(vS,
BgQ(0,!!J,!0,M),9);case 9:k=vS.U;g.EW(vS,8);break;case 7:G=g.Cz(vS);if(!(G instanceof Error&&G.message==="No data")){G instanceof Error&&G.message==="Empty response body"&&v8(G.message);vS.LX(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.y(vS,U0(p.D,d,p.B),8):g.y(vS,wE(P,"musicPlaylist",p.D,d,p.B),8);case 8:if(!k.length||!X&&k[0].playlistId!==P)return vS.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));case 6:if(X){U=[];I=g.u(k);for(V=I.next();!V.done;V=I.next())S=V.value,S.upToDate||
J&&!S.shouldAutoSyncMetadata||!S.playlistId||(B={autoSync:J},U.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",S.playlistId,"musicPlaylist",0,T6,{musicPlaylistEntityActionMetadata:B})));return vS.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,U))}k.length&&(x=k[0],Z=!!x.upToDate,J&&(n=(Pj=x.shouldAutoSyncMetadata)!=null?Pj:!0,r=(qC=x.shouldAutoSyncVideos)!=null?qC:!0,x.checkInSeconds&&(C=x.checkInSeconds)));if(Z||!n)return vS.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b));pz=[];Q=M[0];W=void 0;if(!Q.downloadMetadata){vS.LX(15);break}return g.y(vS,TA(p.D,Q.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:l=vS.U,W=Number((Yu=(m=l)==null?void 0:m.addedTimestampMillis)!=null?Yu:"0")/1E3;case 15:return g.sW(vS,17),g.y(vS,PRz(p,P,(Z2=W)==null?void 0:Z2.toString(),C),19);case 19:pz=vS.U;g.EW(vS,18);break;case 17:O6=g.Cz(vS);if(!(O6 instanceof Error&&O6.message==="No data")){if(O6 instanceof Error&&O6.message==="Empty response body")v8(O6.message);else return UW=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",TC="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O6 instanceof g.lp&&O6.type==="QUOTA_EXCEEDED"&&(UW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",TC="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),vS.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,UW,TC));vS.LX(18);break}return g.y(vS,wE(P,"musicPlaylist",p.D,d,p.B),18);case 18:if(!r)return vS.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b));vm=[];rQ=new Map;if((N=pz)==null?0:N.length)for(w=g.u(pz),c=w.next();!c.done;c=w.next())t=c.value,D=t.offlineVideoData,b$=void 0,((b$=D)==null?0:b$.videoId)&&rQ.set(D.videoId,D);MC=new Map;Xu=[];if((H=Q)==null?0:(h7=H.tracks)==null?0:h7.length)for(rw=g.u(Q.tracks),oK=rw.next();!oK.done;oK=rw.next())if(zC=oK.value,J4=g.qd(zC).entityId)rQ.has(J4)?(MC.set(J4,rQ.get(J4)),rQ.delete(J4)):Xu.push(J4);OF=Number(((SX=d.actionMetadata)==null?void 0:SX.priority)||0)+1;$u=g.u(rQ.entries());for(VT=$u.next();!VT.done;VT=
$u.next())aj=VT.value,zj=g.u(aj),KH=zj.next().value,kE=zj.next().value,QB=KH,e5=kE,vm.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",QB,"musicTrack",OF,T6,c8(d,e5)));$i=g.u(MC.entries());for(ZG=$i.next();!ZG.done;ZG=$i.next())nH=ZG.value,t$=g.u(nH),Jm=t$.next().value,iY=t$.next().value,D6=Jm,Vb=iY,vm.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D6,"musicTrack",OF,T6,c8(d,Vb)));zl=g.u(Xu);for(TN=zl.next();!TN.done;TN=zl.next())mf=TN.value,vm.push(jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
mf,"musicTrack",0,T6));return vS.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,vm))}})},qJQ=function(p,d){var b,v;
return g.z(function(P){switch(P.D){case 1:return b=o6(d),g.sW(P,2),v=g.qd(d.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.y(P,U0(p.D,d,p.B),5):g.y(P,wE(v,"musicPlaylist",p.D,d,p.B),6);case 6:return g.y(P,Viz(p.D,d.entityKey),5);case 5:g.EW(P,3);break;case 2:return g.Cz(P),P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b))}})},PRz=function(p,d,b,v){var P,M,X;
return g.z(function(a){switch(a.D){case 1:return g.y(a,LpH([d]),2);case 2:return P=a.U,g.y(a,a36(p,P[0],b,v),3);case 3:return M=a.U,X=rE(M.thumbnailDetails),g.y(a,Zy(X),4);case 4:return a.return(P[0].videos)}})},a36=function(p,d,b,v){var P,M,X,a,F,h,O,J,k;
return g.z(function(n){return n.D==1?(P=d.playlistId,M=e6z(d),X=M.UK,a=M.Df,F=b?(Number(b)*1E3).toString():Date.now().toString(),h=d.lastModifiedTimestamp?(Number(d.lastModifiedTimestamp)*1E3).toString():"0",O={id:g.aC(P,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:h,addedTimestampMillis:F,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},J={id:g.aC(P,"musicPlaylist"),title:d.title,playlistId:P,thumbnailDetails:d.thumbnail,visibility:oVQ(d),trackCount:d.totalVideoCount,
tracks:X,downloadMetadata:O.id},v&&(((k=J)==null?0:k.entityMetadata)?J.entityMetadata.nextAutoRefreshIntervalSeconds=String(v):J&&(J.entityMetadata={nextAutoRefreshIntervalSeconds:String(v)})),g.y(n,BN(p.D,{mode:"readwrite",Ib:!0},function(r){var Z=$4(r,J,"musicPlaylist");r=$4(r,O,"musicPlaylistDownloadMetadataEntity");return g.w2.all([Z,r])}),2)):n.return(J)})},oVQ=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},F0R=function(p,d){this.D=p;
this.B=d},kpz=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r;
return g.z(function(Z){switch(Z.D){case 1:return b=o6(d),v=g.qd(d.entityKey),P=v.entityId,M=g.L(d.actionMetadata,h1W),g.sW(Z,2),g.y(Z,OIH(p,P,void 0,(X=M)==null?void 0:X.track,(a=M)==null?void 0:a.albumRelease),4);case 4:if((F=M)==null?0:F.playlistId){Z.LX(5);break}return g.y(Z,DVz(p.D,d.entityKey),5);case 5:g.EW(Z,3);break;case 2:return h=g.Cz(Z),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.lp&&h.type==="QUOTA_EXCEEDED"&&
(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,O,J));case 3:n=Number(((k=d.actionMetadata)==null?void 0:k.priority)||0)+1;var C=(C=g.L(d.actionMetadata,h1W))?{playbackDataActionMetadata:{maximumDownloadQuality:C.maximumDownloadQuality}}:void 0;r=jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",n,JEz,C);return Z.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b,[r]))}})},nVQ=function(p,d){var b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C;
return g.z(function(G){switch(G.D){case 1:return b=o6(d),v=g.qd(d.entityKey),P=v.entityId,g.y(G,TA(p.D,d.entityKey,"musicTrack"),2);case 2:M=G.U;if(!M){X=void 0;G.LX(3);break}return g.y(G,TA(p.D,M.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:X=G.U;case 3:a=X;if(!M||!a)return G.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b));h=g.L(d.actionMetadata,h1W);g.sW(G,5);return g.y(G,OIH(p,P,a.addedTimestampMillis,(O=h)==null?void 0:O.track,(J=h)==null?void 0:J.albumRelease),
7);case 7:n=Number(((k=d.actionMetadata)==null?void 0:k.priority)||0)+1;F=jM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",n,JEz);g.EW(G,6);break;case 5:r=g.Cz(G);if(!(r instanceof Error&&r.message==="No data")){if(r instanceof Error&&r.message==="Empty response body")v8(r.message);else return Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.lp&&r.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),G.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,Z,C));G.LX(6);break}return g.y(G,G6(P,p.D,d,p.B),6);case 6:return G.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",b,F?[F]:void 0))}})},rEC=function(p,d){var b,v;
return g.z(function(P){switch(P.D){case 1:return b=o6(d),g.sW(P,2),v=g.qd(d.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.y(P,U0(p.D,d,p.B),5):g.y(P,G6(v,p.D,d,p.B),6);case 6:return g.y(P,Viz(p.D,d.entityKey),5);case 5:g.EW(P,3);break;case 2:return g.Cz(P),P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",b,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new tj("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
b))}})},OIH=function(p,d,b,v,P){var M,X,a,F,h,O;
return g.z(function(J){switch(J.D){case 1:if(M=v){J.LX(2);break}return g.y(J,gaQ([d]),3);case 3:X=J.U,a=X[0],M=Hj4(a);case 2:return g.y(J,f36(p,M,d,P,b),4);case 4:F=J.U;h=F.musicTrackEntity;O=F.wp;var k=rE(h.thumbnailDetails),n=[];O&&(n=rE(O.thumbnailDetails));return g.y(J,Zy(k.concat(n)),0)}})},f36=function(p,d,b,v,P){var M;
return g.z(function(X){return X.D==1?(P||(P=Date.now().toString()),M={id:g.aC(b,"musicTrackDownloadMetadataEntity"),playbackData:g.aC(b,"playbackData"),addedTimestampMillis:P,videoDownloadContextEntity:g.aC(b,"videoDownloadContextEntity")},v&&(d.albumRelease=v.id),g.y(X,BN(p.D,{mode:"readwrite",Ib:!0},function(a){var F=[],h=$4(a,M,"musicTrackDownloadMetadataEntity");F.push(h);h=$4(a,d,"musicTrack");F.push(h);v&&(a=$4(a,v,"musicAlbumRelease"),F.push(a));return g.w2.all(F)}),2)):X.D!=3?g.y(X,Jj(b,"musicTrackDownloadMetadataEntity",
p.D,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):X.return({musicTrackEntity:d,
wp:v})})},Aj=function(){mh.apply(this,arguments);
this.C="musicTrack"},uOQ=function(p,d,b){d=d===void 0?43200:d;
b=b===void 0?!0:b;var v=v===void 0?!1:v;var P,M;return g.z(function(X){switch(X.D){case 1:if(!p.S.v$())return X.return([]);P=[];g.sW(X,2);return g.y(X,BgQ(d,b,v),4);case 4:P=X.U;g.EW(X,3);break;case 2:g.Cz(X);case 3:return M=NcR(p,P,b,"musicPlaylist"),X.return(M)}})},l3Q=function(){g.U2.apply(this,arguments);
var p=this;this.events=new g.iO(this);this.gE=this.player.G();this.Up={ZsE:function(){return p.D},
Gx:function(){return p.Gx()},
CE:function(d){return p.CE(d)}}},stW=function(p){var d;
p=g.L((d=p.getWatchNextResponse())==null?void 0:d.currentVideoEndpoint,g.mH);if(p==null?0:p.playlistId)var b=p.playlistId;return b},ZIm=function(p,d){var b,v,P,M;
return g.z(function(X){if(X.D==1){b=d.clientPlaybackNonce;v={cpn:b,offlineSourceVisualElement:g.N8(d.RB||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};d.U&&(v.videoFmt=Number(d.U.itag));d.V&&(v.audioFmt=Number(d.V.itag));if((P=stW(d))&&d.videoId){var a=d.videoId;a=P!=="PPSV"?Promise.resolve(!1):p.D.Fy(a);X=g.y(X,a,3)}else X=X.LX(2);return X}X.D!=2&&(M=X.U)&&(v.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");p.U=b;g.Oe("offlinePlaybackStarted",v);g.l$(X)})};
g.uu.prototype.cI=g.vj(45,function(p){return this.app.cI(p)});
g.sf.prototype.cI=g.vj(44,function(p){return g.Zx(this,9,p)});
g.f(DR,HN);g.aK.Object.defineProperties(DR.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.D.entityMetadata},
set:function(p){this.D.entityMetadata=p}}});
g.f(fJX,DR);fJX.prototype.U=function(){return[]};
g.f(uSF,DR);uSF.prototype.U=function(){return[]};
g.f(lJQ,DR);lJQ.prototype.U=function(){return[]};
g.f(szC,DR);szC.prototype.U=function(){return[]};
g.f(ZC6,DR);ZC6.prototype.U=function(){var p=[];this.D.alternateChannel&&p.push(this.D.alternateChannel);this.D.alternateChannelList&&p.push.apply(p,g.E(this.D.alternateChannelList));this.D.oneofChannelEntity&&p.push(this.D.oneofChannelEntity);return[].concat(g.E(new Set(p)))};
g.f(ETH,DR);ETH.prototype.U=function(){var p=[];this.D.entryCollection&&p.push(this.D.entryCollection);return[].concat(g.E(new Set(p)))};
g.f(C22,HN);C22.prototype.U=function(){var p=[];this.D.video&&p.push(this.D.video);return[].concat(g.E(new Set(p)))};
g.f(N$6,DR);N$6.prototype.U=function(){var p=[];this.D.parentPlaylist&&p.push(this.D.parentPlaylist);if(this.D.entries)for(var d=g.u(this.D.entries),b=d.next();!b.done;b=d.next())p.push.apply(p,g.E((new C22(b.value)).U()));return[].concat(g.E(new Set(p)))};
g.f(GlF,DR);GlF.prototype.U=function(){var p=[];this.D.descriptionEntity&&p.push(this.D.descriptionEntity);this.D.creators&&p.push.apply(p,g.E(this.D.creators));this.D.theBiggestFan&&p.push(this.D.theBiggestFan);return[].concat(g.E(new Set(p)))};
g.f(wd2,DR);wd2.prototype.U=function(){return[]};
g.f(Ui6,DR);Ui6.prototype.U=function(){return[]};
g.f(c5m,DR);c5m.prototype.U=function(){return[]};
g.f(y5F,DR);y5F.prototype.U=function(){return[]};
g.f(IJX,DR);IJX.prototype.U=function(){return[]};
g.f(zF4,DR);zF4.prototype.U=function(){return[]};
g.f(jzm,DR);jzm.prototype.U=function(){return[]};
g.f(tEW,DR);tEW.prototype.U=function(){return[]};
g.f(iCQ,DR);iCQ.prototype.U=function(){return[]};
g.f(HCQ,DR);HCQ.prototype.U=function(){var p=[];this.D.downloadsList&&p.push(this.D.downloadsList);this.D.smartDownloadsList&&p.push(this.D.smartDownloadsList);this.D.recommendedDownloadsList&&p.push(this.D.recommendedDownloadsList);this.D.refresh&&p.push(this.D.refresh);return[].concat(g.E(new Set(p)))};
g.f(DiW,HN);DiW.prototype.U=function(){var p=[];this.D.video&&p.push(this.D.video);this.D.playlist&&p.push(this.D.playlist);this.D.videoItem&&p.push(this.D.videoItem);this.D.playlistItem&&p.push(this.D.playlistItem);return[].concat(g.E(new Set(p)))};
g.f(VEQ,DR);VEQ.prototype.U=function(){var p=[];this.D.refresh&&p.push(this.D.refresh);if(this.D.downloads)for(var d=g.u(this.D.downloads),b=d.next();!b.done;b=d.next())p.push.apply(p,g.E((new DiW(b.value)).U()));return[].concat(g.E(new Set(p)))};
g.f(eFX,DR);eFX.prototype.U=function(){var p=[];this.D.localImageEntities&&p.push.apply(p,g.E(this.D.localImageEntities));return[].concat(g.E(new Set(p)))};
g.f(SUq,DR);SUq.prototype.U=function(){var p=[];this.D.playbackData&&p.push(this.D.playbackData);this.D.localImageEntities&&p.push.apply(p,g.E(this.D.localImageEntities));this.D.videoDownloadContextEntity&&p.push(this.D.videoDownloadContextEntity);return[].concat(g.E(new Set(p)))};
g.f(YUH,DR);YUH.prototype.U=function(){return[]};
g.f(gTq,DR);gTq.prototype.U=function(){var p=[];this.D.fakeChildren&&p.push.apply(p,g.E(this.D.fakeChildren));return[].concat(g.E(new Set(p)))};
g.f(LZz,DR);LZz.prototype.U=function(){var p=[];this.D.video&&p.push(this.D.video);this.D.playbackData&&p.push(this.D.playbackData);this.D.offlineVideoPolicy&&p.push(this.D.offlineVideoPolicy);return[].concat(g.E(new Set(p)))};
g.f(Qz2,DR);Qz2.prototype.U=function(){return[]};
g.f($iW,DR);$iW.prototype.U=function(){var p=[];this.D.channelOwner&&p.push(this.D.channelOwner);this.D.videos&&p.push.apply(p,g.E(this.D.videos));this.D.collaboratorChannels&&p.push.apply(p,g.E(this.D.collaboratorChannels));this.D.downloadState&&p.push(this.D.downloadState);this.D.refresh&&p.push(this.D.refresh);return[].concat(g.E(new Set(p)))};
g.f(mi2,DR);mi2.prototype.U=function(){var p=[];this.D.video&&p.push(this.D.video);this.D.channelContributor&&p.push(this.D.channelContributor);return[].concat(g.E(new Set(p)))};
g.f(KZ6,HN);KZ6.prototype.U=function(){var p=[];this.D.localImageEntities&&p.push.apply(p,g.E(this.D.localImageEntities));this.D.videoDownloadContextEntity&&p.push(this.D.videoDownloadContextEntity);return[].concat(g.E(new Set(p)))};
g.f(xiR,HN);xiR.prototype.U=function(){var p=[];this.D.recommendedVideoMetadata&&p.push.apply(p,g.E((new KZ6(this.D.recommendedVideoMetadata)).U()));return[].concat(g.E(new Set(p)))};
g.f(B$W,HN);B$W.prototype.U=function(){var p=[];this.D.playbackPosition&&p.push(this.D.playbackPosition);return[].concat(g.E(new Set(p)))};
g.f(RFR,DR);RFR.prototype.U=function(){var p=[];this.D.owner&&p.push(this.D.owner);this.D.downloadState&&p.push(this.D.downloadState);this.D.userState&&p.push.apply(p,g.E((new B$W(this.D.userState)).U()));this.D.additionalMetadata&&p.push.apply(p,g.E((new xiR(this.D.additionalMetadata)).U()));return[].concat(g.E(new Set(p)))};
g.f(T$z,DR);T$z.prototype.U=function(){var p=[];this.D.userChannelDetails&&p.push(this.D.userChannelDetails);return[].concat(g.E(new Set(p)))};
g.f(A5W,DR);A5W.prototype.U=function(){var p=[];this.D.channelOwner&&p.push(this.D.channelOwner);this.D.playbackPosition&&p.push(this.D.playbackPosition);this.D.localImageEntities&&p.push.apply(p,g.E(this.D.localImageEntities));this.D.downloadStatus&&p.push(this.D.downloadStatus);return[].concat(g.E(new Set(p)))};
g.f(WZR,DR);WZR.prototype.U=function(){return[]};
g.f(ppC,DR);ppC.prototype.U=function(){return[]};
g.f(dg6,DR);dg6.prototype.U=function(){return[]};
g.f(brR,DR);brR.prototype.U=function(){return[]};
g.f(vpH,DR);vpH.prototype.U=function(){return[]};
g.f(P86,DR);P86.prototype.U=function(){return[]};
g.f(Msq,DR);Msq.prototype.U=function(){return[]};
g.f(Xp3,DR);Xp3.prototype.U=function(){return[]};
g.f(qmH,DR);qmH.prototype.U=function(){return[]};
g.f(a66,DR);a66.prototype.U=function(){return[]};
g.f(opX,DR);opX.prototype.U=function(){return[]};
g.f(FSQ,DR);FSQ.prototype.U=function(){var p=[];this.D.trackDownloadMetadatas&&p.push.apply(p,g.E(this.D.trackDownloadMetadatas));return[].concat(g.E(new Set(p)))};
g.f(hu6,DR);
hu6.prototype.U=function(){var p=[];this.D.downloadedTracks&&p.push.apply(p,g.E(this.D.downloadedTracks));this.D.smartDownloadedTracks&&p.push.apply(p,g.E(this.D.smartDownloadedTracks));this.D.downloadedEpisodes&&p.push.apply(p,g.E(this.D.downloadedEpisodes));this.D.downloadedAlbumReleases&&p.push.apply(p,g.E(this.D.downloadedAlbumReleases));this.D.smartDownloadedAlbumReleases&&p.push.apply(p,g.E(this.D.smartDownloadedAlbumReleases));this.D.downloadedPlaylists&&p.push.apply(p,g.E(this.D.downloadedPlaylists));this.D.smartDownloadedPlaylists&&
p.push.apply(p,g.E(this.D.smartDownloadedPlaylists));this.D.metadataOnlyTracks&&p.push.apply(p,g.E(this.D.metadataOnlyTracks));return[].concat(g.E(new Set(p)))};
g.f(OrW,DR);OrW.prototype.U=function(){var p=[];this.D.trackDownloadMetadatas&&p.push.apply(p,g.E(this.D.trackDownloadMetadatas));return[].concat(g.E(new Set(p)))};
g.f(Jfz,DR);Jfz.prototype.U=function(){var p=[];this.D.playbackData&&p.push(this.D.playbackData);this.D.localImageEntities&&p.push.apply(p,g.E(this.D.localImageEntities));this.D.videoDownloadContextEntity&&p.push(this.D.videoDownloadContextEntity);return[].concat(g.E(new Set(p)))};
g.f(kKW,DR);kKW.prototype.U=function(){var p=[];this.D.musicLibraryStatusEntity&&p.push(this.D.musicLibraryStatusEntity);this.D.primaryArtists&&p.push.apply(p,g.E(this.D.primaryArtists));this.D.details&&p.push(this.D.details);this.D.userDetails&&p.push(this.D.userDetails);this.D.tracks&&p.push.apply(p,g.E(this.D.tracks));this.D.share&&p.push(this.D.share);this.D.downloadMetadata&&p.push(this.D.downloadMetadata);this.D.refresh&&p.push(this.D.refresh);return[].concat(g.E(new Set(p)))};
g.f(npQ,DR);npQ.prototype.U=function(){var p=[];this.D.albumRelease&&p.push(this.D.albumRelease);this.D.tracks&&p.push.apply(p,g.E(this.D.tracks));return[].concat(g.E(new Set(p)))};
g.f(rfW,DR);rfW.prototype.U=function(){var p=[];this.D.albumRelease&&p.push(this.D.albumRelease);return[].concat(g.E(new Set(p)))};
g.f(f63,DR);f63.prototype.U=function(){var p=[];this.D.details&&p.push(this.D.details);this.D.userDetails&&p.push(this.D.userDetails);return[].concat(g.E(new Set(p)))};
g.f(ueq,DR);ueq.prototype.U=function(){var p=[];this.D.parentArtist&&p.push(this.D.parentArtist);return[].concat(g.E(new Set(p)))};
g.f(l6q,DR);l6q.prototype.U=function(){var p=[];this.D.parentArtist&&p.push(this.D.parentArtist);return[].concat(g.E(new Set(p)))};
g.f(sxQ,DR);sxQ.prototype.U=function(){return[]};
g.f(ZrC,DR);ZrC.prototype.U=function(){return[]};
g.f(EpR,HN);EpR.prototype.U=function(){var p=[];this.D.creatorEntity&&p.push(this.D.creatorEntity);return[].concat(g.E(new Set(p)))};
g.f(C8z,DR);
C8z.prototype.U=function(){var p=[];this.D.tracks&&p.push.apply(p,g.E(this.D.tracks));this.D.refresh&&p.push(this.D.refresh);this.D.musicLibraryStatusEntity&&p.push(this.D.musicLibraryStatusEntity);this.D.details&&p.push(this.D.details);this.D.downloadMetadata&&p.push(this.D.downloadMetadata);this.D.sideloadMetadata&&p.push(this.D.sideloadMetadata);this.D.userDetails&&p.push(this.D.userDetails);this.D.entryCollection&&p.push(this.D.entryCollection);this.D.share&&p.push(this.D.share);this.D.podcastShowAdditionalMetadata&&p.push.apply(p,
g.E((new EpR(this.D.podcastShowAdditionalMetadata)).U()));return[].concat(g.E(new Set(p)))};
g.f(Noq,DR);Noq.prototype.U=function(){return[]};
g.f(GKF,DR);
GKF.prototype.U=function(){var p=[];this.D.musicLibraryStatusEntity&&p.push(this.D.musicLibraryStatusEntity);this.D.artists&&p.push.apply(p,g.E(this.D.artists));this.D.audioModeVersion&&p.push(this.D.audioModeVersion);this.D.videoModeVersion&&p.push(this.D.videoModeVersion);this.D.userDetails&&p.push(this.D.userDetails);this.D.details&&p.push(this.D.details);this.D.albumRelease&&p.push(this.D.albumRelease);this.D.share&&p.push(this.D.share);this.D.libraryEdit&&p.push(this.D.libraryEdit);this.D.downloadMetadata&&
p.push(this.D.downloadMetadata);this.D.playbackPosition&&p.push(this.D.playbackPosition);this.D.lyrics&&p.push(this.D.lyrics);return[].concat(g.E(new Set(p)))};
g.f(wp2,DR);wp2.prototype.U=function(){var p=[];this.D.parentTrack&&p.push(this.D.parentTrack);return[].concat(g.E(new Set(p)))};
g.f(UgQ,DR);UgQ.prototype.U=function(){var p=[];this.D.parentTrack&&p.push(this.D.parentTrack);return[].concat(g.E(new Set(p)))};
g.f(cfq,DR);cfq.prototype.U=function(){return[]};
g.f(yfF,DR);yfF.prototype.U=function(){return[]};
g.f(I6m,DR);I6m.prototype.U=function(){return[]};
g.f(zuW,DR);zuW.prototype.U=function(){return[]};
g.f(jxC,DR);jxC.prototype.U=function(){var p=[];this.D.transfer&&p.push(this.D.transfer);this.D.adsPlaybackData&&p.push.apply(p,g.E(this.D.adsPlaybackData));this.D.drmLicense&&p.push(this.D.drmLicense);this.D.offlineVideoPolicy&&p.push(this.D.offlineVideoPolicy);this.D.videoDownloadContextEntity&&p.push(this.D.videoDownloadContextEntity);return[].concat(g.E(new Set(p)))};
g.f(tsR,DR);tsR.prototype.U=function(){return[]};
g.f(irX,DR);irX.prototype.U=function(){var p=[];this.D.offlineVideoStreams&&p.push.apply(p,g.E(this.D.offlineVideoStreams));this.D.captionTrack&&p.push.apply(p,g.E(this.D.captionTrack));return[].concat(g.E(new Set(p)))};
g.f(HrH,DR);HrH.prototype.U=function(){return[]};
g.f(Dgq,DR);Dgq.prototype.U=function(){return[]};
g.f(Vsq,DR);Vsq.prototype.U=function(){return[]};
g.f(euQ,DR);euQ.prototype.U=function(){return[]};
g.f(SmR,DR);SmR.prototype.U=function(){return[]};
g.f(Ymq,DR);Ymq.prototype.U=function(){return[]};
g.f(gp6,DR);gp6.prototype.U=function(){return[]};
g.f(LS2,DR);LS2.prototype.U=function(){return[]};
g.f(QxR,DR);QxR.prototype.U=function(){return[]};
g.f($gq,DR);$gq.prototype.U=function(){return[]};
g.f(mg3,DR);mg3.prototype.U=function(){return[]};
g.f(KS2,DR);KS2.prototype.U=function(){return[]};
g.f(xgm,DR);xgm.prototype.U=function(){return[]};
g.f(BoF,DR);BoF.prototype.U=function(){return[]};
g.f(RuF,DR);RuF.prototype.U=function(){return[]};
g.f(To4,DR);To4.prototype.U=function(){return[]};
g.f(AfC,DR);AfC.prototype.U=function(){return[]};
g.f(WSq,DR);WSq.prototype.U=function(){return[]};
var R6W=["browse","music/browse","unplugged/browse"],deW=["offline/playlist_sync_check"],Y1X=["offline"],Tg4=["offline/offline_video_playback_position_sync"],WpW=["offline/get_playback_data_entity"],Vk;e1.getInstance=function(){return g.z(function(p){return p.return(new Promise(function(d){g.d_().then(function(b){b?(e1.instance||(e1.instance=new e1(b)),d(e1.instance)):d(void 0)})}))})};
e1.prototype.get=function(p){var d=this,b,v,P;return g.z(function(M){if(M.D==1)return g.y(M,vNF(d.token),2);if(M.D!=3)return b=M.U,g.y(M,b.get("prefs",p),3);v=M.U;if(!v)return M.return();P=(0,g.Ib)();return v.expirationTimestampMs<=P?M.return():M.return(v.value)})};
e1.prototype.set=function(p,d,b){b=b===void 0?31536E3:b;var v=this,P,M,X;return g.z(function(a){if(a.D==1)return P=(0,g.Ib)(),M={key:p,value:d,expirationTimestampMs:P+b*1E3},g.y(a,vNF(v.token),2);X=a.U;return g.y(a,g.DM(X,"prefs",M),0)})};
e1.prototype.remove=function(p){var d=this,b;return g.z(function(v){if(v.D==1)return g.y(v,vNF(d.token),2);b=v.U;return g.y(v,b.delete("prefs",p),0)})};
g.f(S1,g.RN);g.f(Y4,ajR);Y4.prototype.B=function(p,d){d=FUH(d);p=(new TextEncoder).encode(JSON.stringify(p));return this.D.encrypt(p,d)};
Y4.prototype.U=function(p,d){if(!(p instanceof Uint8Array))throw Pn2(1);var b=new TextDecoder;d=FUH(d);p=this.D.decrypt(p,d);return JSON.parse(b.decode(p))};
var hy4={accountLinkStatusEntity:c5m,booleanEntity:lJQ,buttonEntity:mg3,captionTrack:cfq,channelHandle:fJX,commerceAcquisitionClientPayloadEntity:xgm,commerceCartListEntity:BoF,contextNoteFeedEntityPayload:uSF,continuationTokenEntity:Qz2,downloadQualityPickerEntity:jzm,downloadsPageRefreshTokenEntity:iCQ,downloadsPageViewConfigurationEntity:WZR,downloadStatusEntity:tEW,dismissState:SmR,sfvAudioItemCurrentlyPlayingEntity:Dgq,emojiFountainDataEntity:QxR,emojiCustomizationSetEntity:LS2,fakeChannel:ZC6,
fakePlaylist:ETH,fakePlaylistEntryCollection:N$6,fakeVideo:GlF,fakeVideoDescription:wd2,featuredProductsEntity:qmH,flowStateEntity:Ui6,iconBadgeEntity:RuF,interstitialInteractionStateEntity:IJX,likeButtonAnimationEntity:ppC,liveChatPollStateEntity:zF4,liveReactionsDataEntity:$gq,logoEntity:y5F,macroMarkerEntity:dg6,mainDownloadsLibraryEntity:HCQ,mainDownloadsListEntity:VEQ,mainPlaylistDownloadStateEntity:eFX,mainPlaylistEntity:$iW,mainPlaylistVideoEntity:mi2,mainVideoDownloadStateEntity:SUq,mainVideoEntity:RFR,
markersEngagementPanelSyncEntity:brR,markersVisibilityOverrideEntity:vpH,musicAlbumReleaseDetail:npQ,musicAlbumReleaseDownloadMetadataEntity:FSQ,musicAlbumRelease:kKW,musicAlbumReleaseUserDetail:rfW,musicArtistDetail:ueq,musicArtist:f63,musicArtistUserDetail:l6q,musicDownloadsLibraryEntity:hu6,musicLibraryEdit:sxQ,musicLibraryStatusEntity:ZrC,musicPlaylist:C8z,musicPlaylistDownloadMetadataEntity:OrW,musicShare:Noq,musicTrackDetail:wp2,musicTrackDownloadMetadataEntity:Jfz,musicTrack:GKF,musicTrackUserDetail:UgQ,
offlineOrchestrationActionWrapperEntity:yfF,offlineVideoPolicy:I6m,offlineVideoStreams:zuW,offlineabilityEntity:YUH,orchestrationWebSamplingEntity:gTq,pageHeaderEntity:Ymq,pdpStateEntity:To4,pinnedProductEntity:a66,playbackData:jxC,playerStateEntity:P86,quantityIncrementerEntity:AfC,refresh:tsR,saveToPlaylistListEntity:Vsq,settingEntity:euQ,stringEntity:szC,suggestedFeedbackChipStateEntity:Msq,transfer:irX,trendingOfferEntity:opX,videoDownloadContextEntity:HrH,videoOverviewAsyncDataEntity:WSq,videoPlaybackPositionEntity:KS2,
votingEntity:gp6,ytMainChannelEntity:T$z,youchatPendingResponseEntity:Xp3,ytMainDownloadedVideoEntity:LZz,ytMainVideoEntity:A5W};g.f(K6,ajR);K6.prototype.B=function(p){return p};
K6.prototype.U=function(p){if(p instanceof Uint8Array)throw Pn2(0);return p};
g.f(x4,g.e);x4.prototype.observe=function(p){var d=this;this.observers.push(p);return function(){var b=d.observers.indexOf(p);b>=0&&d.observers.splice(b,1)}};
x4.prototype.U=function(p){GxF(this,p.data)};
x4.prototype.U5=function(){this.channel.close()};
var Ij4,wG2=new g.IE("elementsCommand");var C7=new g.IE("entityBatchUpdate");var kc3=new g.IE("downloadStatusEntity");var I_6=new g.IE("mainPlaylistEntityActionMetadata");var B8=new g.IE("mainVideoEntityActionMetadata");var S1R=new g.IE("musicPlaylistEntityActionMetadata");var h1W=new g.IE("musicTrackEntityActionMetadata");var mKR=new g.IE("localImageEntityActionMetadata");var iP=new g.IE("playbackDataActionMetadata");var UeH=new g.IE("transferEntityActionMetadata");var OPQ=new g.IE("videoPlaybackPositionEntityActionMetadata");var mM4;new g.fC;new g.fC;TS6.prototype.request=function(p,d,b){d=d===void 0?{}:d;return this.locks.request(p,d,function(v){return b(v)})};var bP=g.ee.caches,dE,bjQ;p7.prototype.open=function(p){return bP.open(pG2(p))};
p7.prototype.has=function(p){return bP.has(pG2(p))};
p7.prototype.delete=function(p){return bP.delete(pG2(p))};
p7.prototype.match=function(p,d){var b=this,v,P,M,X,a,F;return g.z(function(h){switch(h.D){case 1:return g.y(h,b.keys(),2);case 2:v=h.U,P=g.u(v),M=P.next();case 3:if(M.done){h.LX(5);break}X=M.value;return g.y(h,b.open(X),6);case 6:return a=h.U,g.y(h,a.match(p,d),7);case 7:if(F=h.U)return h.return(F);M=P.next();h.LX(3);break;case 5:return h.return()}})};
g.f(WUm,p7);WUm.prototype.keys=function(){var p,d,b,v,P,M,X,a,F;return g.z(function(h){if(h.D==1)return p=[],d=g.TZ("CacheStorage keys"),g.y(h,bP.keys(),2);b=h.U;v=g.u(b);for(P=v.next();!P.done;P=v.next()){M=P.value;var O=M.indexOf(":");X=O===-1?{o$:M}:{o$:M.substring(0,O),datasyncId:M.substring(O+1)};a=X.o$;F=X.datasyncId;F===d&&p.push(a)}return h.return(p)})};g.f(P8,g.e);P8.prototype.B=function(p){this.api.KX("onOfflineOperationFailure",p.data)};
P8.prototype.V=function(p){this.api.publish("offlinetransferpause",p.data)};
P8.prototype.U5=function(){var p;(p=this.D)==null||p.close();var d;(d=this.U)==null||d.close()};Miz.prototype.eE=function(){this.D&&X4(this)};
Miz.prototype.lC=function(){this.U&&this.U.resolve();this.B=this.D=!1;this.C()};var Q_2=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Ch2="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var ijq="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.f(vIz,z6);vIz.prototype.U=function(p){return F4(p)?Xl6(this,p):hj(p)?oIW(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.f(FvW,z6);FvW.prototype.U=function(p){return hj(p)?hq3(this,p):Jqm(p)?Je2(this,p):O0(p)?kIF(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.q=nIX.prototype;g.q.b9J=function(p){var d=this,b,v,P,M;return g.z(function(X){if(!g.R(p.state,128))return X.LX(0);b=p.state.h9;var a=(v=b)==null?void 0:v.errorCode,F=(P=b)==null?void 0:P.zb;M=a==="net.connect"&&F===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(a==null?0:a.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.y(X,d.w8(d.player.getVideoData().videoId,M),0)})};
g.q.w8=function(p,d){var b=this;return g.z(function(v){if(v.D==1){if(b.U)return v.return();b.U=!0;return d==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(VW(b,p,!1,!0),v.LX(0)):g.y(v,Dy(b,p),3)}g.NZ(p,4);return g.y(v,b.D.w8(d),0)})};
g.q.SN=function(p){p.status===2?(p.status!==this.B&&(h4H(this.D),g.NZ(p.videoId,2)),p.Wo&&rrm(this.D,p.videoId,p.Wo)):p.status===4?(Dy(this,p.videoId),this.w8(p.videoId,p.PU?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):p.status===1&&noQ(this.D);this.B=p.status;this.api.KX("localmediachange",{videoId:p.videoId,status:p.status})};
g.q.K_=function(){var p=this,d;return g.z(function(b){if(b.D==1){if(p.U)return b.return();p.U=!0;d=p.player.getVideoData().videoId;return g.y(b,Dy(p,d),2)}return g.y(b,p.D.K_(),0)})};
g.q.b6=function(p){switch(p){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.q.T=function(p){return this.api.G().T(p)};g.f(EI6,z6);EI6.prototype.U=function(p){return F4(p)?NN6(this,p):hj(p)?GIq(this,p):Jqm(p)?wlR(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};j_X.prototype.D=function(p,d){var b=p.action.actionMetadata.priority-d.action.actionMetadata.priority;b===0&&(p.D<d.D?b=-1:p.D>d.D&&(b=1));return b};g.f(eM,g.e);eM.prototype.U5=function(){this.C&&this.C();g.e.prototype.U5.call(this)};
eM.prototype.createAction=function(p,d){var b=g.qd(p.entityKey).entityType,v=g.GW(16);return new f7(b,v,p,d.actionId,d.rootActionId)};
eM.prototype.O5=function(p){var d=this,b,v,P,M,X,a,F,h,O;return g.z(function(J){if(J.D==1){if(d.xJ())return J.return();v=(b=p.offlineOrchestrationActionWrapperEntity)!=null?b:new Set;P=[];M=g.u(v);for(X=M.next();!X.done;X=M.next())a=X.value,F=g.qd(a),h=F.entityId,HPz(d.D,h)||P.push(a);return g.y(J,KvW(d,P),2)}O=J.U;return g.y(J,meX(d,O),0)})};
eM.prototype.retry=function(){var p=this;return g.z(function(d){return g.y(d,xeQ(p),0)})};RqQ.prototype.rH=function(p,d){d=d===void 0?!0:d;var b=this,v,P,M,X,a,F,h,O;return g.z(function(J){switch(J.D){case 1:if(!b.D)return J.return();v=[];P=g.nK(b.D.U,d);M=[];for(X={cG:0};X.cG<P.length;X={cG:X.cG},X.cG++)a=P[X.cG],F=b.D.NV(a,"json3"),h=g.tk(F,{withCredentials:!0,format:"RAW"},3,500).then(function(k){return function(n){n={metadata:g.oJ(P[k.cG]),trackData:n.xhr.responseText};M.push(n)}}(X)).FM(function(k){v8("Caption fetch error",k)}),v.push(h);
return g.y(J,r5W(v),2);case 2:return g.sW(J,3),g.y(J,eyH(p,M),5);case 5:g.EW(J,0);break;case 3:O=g.Cz(J),v8("Caption DB transaction error",O),g.l$(J)}})};g.f(SM,g.e);SM.prototype.U5=function(){this.U&&this.U();g.e.prototype.U5.call(this)};
SM.prototype.B=function(p){var d=this,b,v,P,M,X,a,F,h;return g.z(function(O){v=(b=p.transfer)!=null?b:new Set;P=[];M=g.u(v);for(X=M.next();!X.done;X=M.next())a=X.value,F=g.qd(a),h=F.entityId,P.push(h);return P.length===0?O.return():g.y(O,WvQ(d,P),0)})};g.f(PNX,g.e);g.q=PNX.prototype;g.q.U5=function(){this.kJ&&this.kJ();this.aB.dispose();this.V.dispose();this.Hb&&g.S6(this.S.w9,this.Hb);this.IB&&g.S6(this.S.w9,this.IB);g.e.prototype.U5.call(this)};
g.q.waZ=function(p){var d=this,b,v,P;return g.z(function(M){switch(M.D){case 1:b=g.aC(p,"transfer");if(d.D&&b===d.D.key){VW(d.Z,d.X,!0);d.V.stop();M.LX(0);break}return g.y(M,BN(d.U,{mode:"readwrite",Ib:!0},function(X){return gO(X,b,"transfer").then(function(a){if(a&&a.transferState!=="TRANSFER_STATE_COMPLETE"&&a.transferState!=="TRANSFER_STATE_FAILED")return a.transferState="TRANSFER_STATE_PAUSED_BY_USER",$4(X,a,"transfer").then(function(){return a})})}),3);
case 3:v=M.U;if(!v){M.LX(0);break}if(!p||!d.B){M.LX(5);break}return g.y(M,Jj(p,d.B,d.U,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.y(M,L7(d,p),7);case 7:P=M.U,h6W({videoId:p,DZ:v,offlineModeType:P}),g.l$(M)}})};
g.q.uNB=function(){var p=this;if(this.D&&this.X){VW(this.Z,this.X,!1);var d=this.D,b=(d==null?0:d.key)?g.qd(d.key).entityId:"";b&&this.B&&(new Promise(function(v,P){Jj(b,p.B,p.U,"DOWNLOAD_STATE_PAUSED").catch(function(M){P(M)})})).catch(function(v){v8("Download state setting error",v)})}this.V.stop()};
g.q.VA=function(){this.D?q52(this,this.D):gE(this)};
g.q.Dd=function(p){var d=this;return g.z(function(b){switch(b.D){case 1:if(!d.D){b.LX(2);break}if(d.D.transferState==="TRANSFER_STATE_COMPLETE"||d.D.transferState==="TRANSFER_STATE_FAILED"||!p.transfer||!p.transfer.has(d.D.key)){b.LX(3);break}return g.y(b,TA(d.U,d.D.key,"transfer"),4);case 4:d.D=b.U;if(d.D){b.LX(3);break}return g.y(b,a_H(d),3);case 3:if(d.D)return b.return();case 2:return g.y(b,gE(d),0)}})};
g.q.w8=function(p,d){var b=this,v,P,M,X,a;return g.z(function(F){switch(F.D){case 1:if(!b.D){QW(b,"onTransferFailure: "+p);F.LX(2);break}v=b.D;M=((P=v)==null?0:P.key)?g.qd(v.key).entityId:"";a:switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var h=!1;break a;default:h=!0}return h&&f_W(b)?g.y(F,$2(b,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.y(F,
u7F(b,p),5);case 5:if(!M||!b.B){F.LX(2);break}return g.y(F,Jj(M,b.B,b.U,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.y(F,L7(b,M),9);case 9:X=F.U;a6({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:M,DZ:v,offlineModeType:X});if(!M||!b.B){F.LX(2);break}return g.y(F,Jj(M,b.B,b.U,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Y2(b),a=gE(b,!0),d&&d(a),g.l$(F)}})};
g.q.K_=function(p){var d=this,b,v,P,M,X,a,F,h,O,J,k,n;return g.z(function(r){switch(r.D){case 1:if(!d.D){QW(d,"onMaybeTransferStreamsExpired");r.LX(2);break}return f_W(d)?g.y(r,$2(d,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.y(r,u7F(d,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!d.B){r.LX(2);break}b=d.D;P=((v=b)==null?0:v.key)?g.qd(b.key).entityId:"";if(!P){r.LX(2);break}return g.y(r,Jj(P,d.B,d.U,"DOWNLOAD_STATE_FAILED"),2);case 9:return d.D||QW(d,"onMaybeTransferStreamsExpiredRetryAttempting"),
M=d.D,a=((X=M)==null?0:X.key)?g.qd(M.key).entityId:"",g.y(r,L7(d,a),10);case 10:return F=r.U,a6({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:a,DZ:M,offlineModeType:F}),h=fQ3(),g.gK(h,iP,{isEnqueuedForExpiredStreamUrlRefetch:!0}),O=g.aC(a,"playbackData"),J={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:O,actionMetadata:h},k=lP(new f7("playbackData",a,J)),g.y(r,RX(d.U,k,"offlineOrchestrationActionWrapperEntity"),2);case 2:Y2(d),n=gE(d,!0),
p&&p(n),g.l$(r)}})};
var EVz={},l_m=(EVz.TRANSFER_STATE_TRANSFERRING=1,EVz.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,EVz);g.q=mh.prototype;g.q.Qs=function(){return this.X.promise};
g.q.h3=function(){if(this.U&&this.Z)return this.X.promise;Eoz(this).then(this.X.resolve).catch(this.X.reject);return this.X.promise};
g.q.jf=function(p){var d={};return d.playbackData=new vIz(p,this.gE,this.D),d.transfer=new EI6(p,this.gE),d.videoPlaybackPositionEntity=new FvW(p,this.gE),d};
g.q.kc=function(){var p=this;return g.z(function(d){return p.U?g.y(d,MdH(p.U),0):d.LX(0)})};
g.q.F8=function(){var p=this,d,b;return g.z(function(v){if(v.D==1)return p.U||p.Z?g.y(v,p.Qs(),2):v.return();p.W!==void 0&&(g.EI(p.W),p.W=void 0);p.V!==void 0&&(g.EI(p.V),p.V=void 0);(d=p.U)==null||d.dispose();p.U=void 0;(b=p.Z)==null||b.dispose();p.Z=void 0;p.api.KX("onOrchestrationLostLeader");p.X=new g.fC;g.l$(v)})};
g.q.isOrchestrationLeader=function(){return this.B.D};
g.q.Fy=function(){return g.z(function(p){return p.return(!1)})};
g.q.Q4=function(p){var d=this.D;d.api.publish("offlinetransferpause",p);var b;(b=d.U)==null||b.postMessage(p)};
g.q.VA=function(p){var d,b;return g.z(function(v){if(v.D==1)return g.y(v,WN(),2);d=v.U;if(!d)return v.return();b=g.aC(p,"transfer");return g.y(v,BN(d,{mode:"readwrite",Ib:!0},function(P){var M=gO(P,b,"transfer"),X=gO(P,g.aC(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w2.all([M,X]).then(function(a){a=g.u(a);var F=a.next().value;var h=a.next().value;return F&&F.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(F.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",$4(P,F,"transfer").then(function(){a6({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:p,DZ:F,offlineModeType:h==null?void 0:h.offlineModeType});return g.w2.resolve(null)})):g.w2.resolve(null)})}),0)})};
g.q.A5=function(p){p=p===void 0?43200:p;var d=this,b,v,P,M,X,a,F,h;return g.z(function(O){if(O.D==1)return d.S.v$()?g.y(O,WN(),2):O.return(CNW());if(O.D!=3){b=O.U;if(!b)return O.return([]);v=Date.now()/1E3;return g.y(O,AJ(b,"offlineVideoPolicy"),3)}P=O.U;M=[];X=g.u(P);for(a=X.next();!a.done;a=X.next())F=a.value,Number(F.lastUpdatedTimestampSeconds)+p<=v&&(h=g.qd(F.key).entityId,M.push(h));return M.length?O.return(K7(d,M,d.C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):O.return([])})};
g.q.deleteAll=function(){return K7(this,["!*$_ALL_ENTITIES_!*$"],this.C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.q.refreshAllStaleEntities=function(p){var d=this;return g.z(function(b){return b.D==1?g.y(b,d.A5(p),2):b.return(b.U)})};
g.q.setUpPositionSyncInterval=function(p){var d=this;this.V!==void 0&&(g.EI(this.V),this.V=void 0);var b=p!=null?p:864E5;this.V=g.sI(function(){d.KD(b)},b)};
g.q.KD=function(p){var d=this,b,v,P,M,X,a;return g.z(function(F){switch(F.D){case 1:return g.sW(F,2),g.y(F,e1.getInstance(),4);case 4:b=F.U;if(!b)throw Error("prefStorage is undefined");return g.y(F,b.get("psi"),5);case 5:v=F.U;M=((P=v)==null?0:P.WK)?Number(v.WK)/1E3:0;X=Date.now();if(!(M+p<=X)){F.LX(6);break}return g.y(F,K7(d,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.EW(F,0);break;case 2:a=g.Cz(F),v8("Offline manager error",a),
g.l$(F)}})};
g.q.De=function(){var p=this,d,b,v,P,M,X,a;return g.z(function(F){if(F.D==1)return g.y(F,WN(),2);if(F.D!=3)return(d=F.U)?g.y(F,AJ(d,"transfer"),3):F.return([]);b=F.U;v=[];P=g.u(b);for(M=P.next();!M.done;M=P.next())X=M.value,X.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&X.key&&(a=g.qd(X.key).entityId,v.push(a));return F.return(GPR(p,v))})};
g.q.PO=function(){return g.z(function(p){return p.return([])})};
g.q.E9=function(){return g.z(function(p){g.l$(p)})};
g.q.au=function(){return g.z(function(p){g.l$(p)})};g.f(w4Q,z6);w4Q.prototype.U=function(p){return F4(p)?yr3(this,p):hj(p)?z46(this,p):O0(p)?jm3(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var x2=[10];g.f(VdF,z6);VdF.prototype.U=function(p){return F4(p)?Y5m(this,p):hj(p)?go3(this,p):O0(p)?Lr2(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var S5Q=[10];g.f($KQ,z6);$KQ.prototype.U=function(p){return hj(p)?Krz(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.f(xK2,mh);g.q=xK2.prototype;g.q.jf=function(p){var d=mh.prototype.jf.call(this,p);d.mainVideoEntity=new VdF(p,this.gE,this.D);d.mainPlaylistEntity=new w4Q(p,this.gE,this.D);d.mainDownloadsListEntity=new $KQ(p,this.gE,this.D);return d};
g.q.refreshAllStaleEntities=function(p,d){var b=this,v,P,M,X,a,F,h,O,J,k,n;return g.z(function(r){switch(r.D){case 1:v=[];if(!b.gE.T("web_player_offline_playlist_auto_refresh")){r.LX(2);break}return g.y(r,Bc2(b,p,d),3);case 3:v=r.U;case 2:return g.y(r,e1.getInstance(),4);case 4:return P=r.U,g.y(r,(M=P)==null?void 0:M.get("sdois"),5);case 5:return X=r.U,g.y(r,(a=P)==null?void 0:a.get("lmqf"),6);case 6:F=r.U;if(!X){r.LX(7);break}O=v;J=O.concat;return g.y(r,R4z(b,X,(h=F)!=null?h:"SD",p===0),8);case 8:v=
J.call(O,r.U);case 7:return k=v,n=k.concat,g.y(r,mh.prototype.refreshAllStaleEntities.call(b,p,d),9);case 9:return v=n.call(k,r.U),r.return(v)}})};
g.q.Fy=function(p){var d,b,v,P,M,X,a,F;return g.z(function(h){if(h.D==1)return g.y(h,WN(),2);if(h.D!=3)return(d=h.U)?g.y(h,TA(d,g.i1,"mainDownloadsListEntity"),3):h.return(!1);b=h.U;if((v=b)==null?0:(P=v.downloads)==null?0:P.length)for(M=g.aC(p,"mainVideoEntity"),X=g.u(b.downloads),a=X.next();!a.done;a=X.next())if(F=a.value,F.videoItem===M)return h.return(!0);return h.return(!1)})};
g.q.PO=function(){var p=this,d,b,v,P,M,X,a,F;return g.z(function(h){if(h.D==1)return g.y(h,WN(),2);if(h.D!=3)return(d=h.U)?g.y(h,AJ(d,"downloadStatusEntity"),3):h.return([]);b=h.U;v=[];P=g.u(b);for(M=P.next();!M.done;M=P.next())X=M.value,X.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&X.key&&(a=g.qd(X.key).entityId,v.push(a));return v.length?(F={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},h.return(K7(p,v,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
F))):h.return([])})};
g.q.au=function(){var p;return g.z(function(d){return d.D==1?g.y(d,WN(),2):(p=d.U)?g.y(d,BN(p,{mode:"readwrite",Ib:!0},function(b){return L6(b,"mainVideoEntity").then(function(v){var P=[];v=g.u(v);for(var M=v.next();!M.done;M=v.next()){M=M.value;var X=void 0;(X=M.userState)!=null&&X.playbackPosition||(X=g.qd(M.key).entityId,X={key:g.aC(X,"videoPlaybackPositionEntity"),videoId:X,lastPlaybackPositionSeconds:"0"},P.push($4(b,X,"videoPlaybackPositionEntity")),M.userState={playbackPosition:X.key},P.push($4(b,
M,"mainVideoEntity")))}return g.w2.all(P)})}),0):d.return()})};
g.q.E9=function(){var p,d,b,v,P,M,X,a,F,h,O,J,k,n,r,Z,C,G,U,I,V,S,B,x,Pj,qC,pz,Q,W,l,m,Yu,Z2,O6,UW,TC,vm,rQ;return g.z(function(N){if(N.D==1)return g.y(N,WN(),2);if(N.D!=3){p=N.U;if(!p)return N.return();d=g.aC("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.y(N,BN(p,{mode:"readonly",Ib:!0},function(w){return g.w2.all([gO(w,d,"mainDownloadsListEntity"),gO(w,g.i1,"mainDownloadsListEntity"),L6(w,"mainVideoEntity"),L6(w,"mainPlaylistEntity")])}),3)}b=N.U;
v=g.u(b);P=v.next().value;M=v.next().value;X=v.next().value;a=v.next().value;F=P;h=M;O=X;J=a;k=new Set;if((n=F)==null?0:(r=n.downloads)==null?0:r.length)for(Z=g.u(F.downloads),C=Z.next();!C.done;C=Z.next())G=C.value,U=void 0,(I=(U=G.videoItem)!=null?U:G.playlistItem)&&k.add(I);if((V=h)==null?0:(S=V.downloads)==null?0:S.length)for(B=g.u(h.downloads),x=B.next();!x.done;x=B.next())Pj=x.value,Pj.videoItem&&k.add(Pj.videoItem);qC=new Set;pz=[];Q=g.u(J);for(W=Q.next();!W.done;W=Q.next()){l=W.value;if(l.videos)for(m=
g.u(l.videos),Yu=m.next();!Yu.done;Yu=m.next())Z2=Yu.value,(O6=JSON.parse(g.qd(Z2).entityId).videoId)&&qC.add(O6);l.key&&!k.has(l.key)&&pz.push(l.key)}UW=g.u(O);for(TC=UW.next();!TC.done;TC=UW.next())vm=TC.value,vm.key&&!k.has(vm.key)&&(rQ=g.qd(vm.key).entityId,qC.has(rQ)||pz.push(vm.key));return pz.length?g.y(N,IQ2(p,pz),0):N.LX(0)})};g.f(Tc4,z6);Tc4.prototype.U=function(p){return F4(p)?Wr3(this,p):hj(p)?pgq(this,p):O0(p)?dt2(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var R6=[10];g.f(vVQ,z6);vVQ.prototype.U=function(p){return F4(p)?MNz(this,p):hj(p)?Xg3(this,p):O0(p)?qJQ(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var T6=[10];g.f(F0R,z6);F0R.prototype.U=function(p){return F4(p)?kpz(this,p):hj(p)?nVQ(this,p):O0(p)?rEC(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var JEz=[10];g.f(Aj,mh);Aj.prototype.jf=function(p){var d=mh.prototype.jf.call(this,p);d.musicTrack=new F0R(p,this.D);d.musicPlaylist=new vVQ(p,this.D);d.musicAlbumRelease=new Tc4(p,this.D);return d};
Aj.prototype.refreshAllStaleEntities=function(p,d){var b=this,v,P,M;return g.z(function(X){if(X.D==1)return g.y(X,uOQ(b,p,d),2);if(X.D!=3)return P=v=X.U,M=P.concat,g.y(X,mh.prototype.refreshAllStaleEntities.call(b,p,d),3);v=M.call(P,X.U);return X.return(v)})};g.f(l3Q,g.U2);g.q=l3Q.prototype;g.q.create=function(){var p=this;g.Y(this,this.events);g.QJ(this.gE)?this.D=new xK2(this.gE,this.player):g.eo(this.gE)&&(this.D=new Aj(this.gE,this.player));this.events.Y(this.player,"onPlaybackStartExternal",function(){p.Gx()});
this.events.Y(this.player,"videodatachange",function(){p.Gx()});
this.gE.T("html5_offline_playback_position_sync")&&this.events.Y(this.player,"presentingplayerstatechange",this.CE)};
g.q.Ut=function(){return!1};
g.q.r$=function(p,d,b,v){var P=this;return g.z(function(M){return P.D?M.return(K7(P.D,p,d,b,v)):M.return(Promise.reject())})};
g.q.deleteAll=function(){return this.D.deleteAll()};
g.q.A5=function(p){return this.D.A5(p)};
g.q.refreshAllStaleEntities=function(p){return this.D.refreshAllStaleEntities(p)};
g.q.setUpPositionSyncInterval=function(p){this.D.setUpPositionSyncInterval(p)};
g.q.Q4=function(p){this.D.Q4(p)};
g.q.VA=function(p){return this.D.VA(p)};
g.q.Gx=function(){var p=this,d;return g.z(function(b){d=p.player.getVideoData();return g.$S(d)?stW(d)&&p.U!==d.clientPlaybackNonce?g.y(b,ZIm(p,d),0):b.LX(0):b.return()})};
g.q.CE=function(p){var d=this,b,v,P,M,X,a,F;return g.z(function(h){if(h.D==1)return b=d.player.getVideoData(),v=b.TB,g.ry(p,2)||g.ry(p,512)?g.y(h,WN(),2):h.return();if(h.D!=3){P=h.U;if(!P)return v8("PES is undefined"),h.return();M=b.videoId;return g.y(h,TA(P,g.aC(M,"mainVideoEntity"),"mainVideoEntity"),3)}X=h.U;if(!X)return h.return();a=Math.floor(v).toString();F={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:a}};return g.y(h,d.r$([M],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
F),0)})};
g.q.isOrchestrationLeader=function(){return this.D.isOrchestrationLeader()};
g.q.updateDownloadState=function(p,d){var b,v,P,M;return g.z(function(X){if(X.D==1)return g.y(X,WN(),2);b=X.U;if(!b)return v8("PES is undefined"),X.return();v=g.qd(p);P=v.entityType;M=v.entityId;return g.y(X,Jj(M,P,b,d,!0),0)})};g.wG("offline",l3Q);})(_yt_player);
